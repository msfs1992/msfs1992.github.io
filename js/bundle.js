(()=>{"use strict";var t=[,(t,i,s)=>{s.r(i),s.d(i,{default:()=>d});var h,n,o=.01;let a=document.getElementById("fps");var l=0;document.getElementById("Vertices");let r;document.getElementById("Faces"),document.getElementById("Objects");var m,B,w,u,A,c;const d=class{t=100;debug=!1;i;h;brickshape;o;l;m=[];B=[];u;A;p=!1;L;O=!1;g=Date.now();N=!1;Y;v=0;_=new BABYLON.Quaternion(0,0,0,1);k=!1;M=!1;P=Date.now();C=!1;R=[];T=!1;S;D=null;F;G;j;I=[];H;W=!1;U=Date.now();Z=!1;K=new BABYLON.Vector3(0,0,0);V=new BABYLON.Quaternion(0,0,0,1);J=!1;q=Date.now();X;$={shift:!1,f:!1,w:!1,tt:!1};it=[];animations=[];st=[];ht=[];et="";nt="";ot=[];lt=!1;rt;Bt;wt=!1;ut=!1;At=!1;ct=null;dt=!1;Lt=.05;Ot=.1;ft=.05;gt;Nt;Yt=!1;yt;vt;bt=!1;_t=!1;kt=0;xt=1;Mt=!1;Pt=Date.now();Ct=null;Rt=null;Tt=null;St=null;zt=null;meshes=[];Dt=!1;Ft={x:-.04,y:.06,z:.06};Gt={x:1.51,y:-3.14,z:.72};jt={x:.019,y:-.04,z:-.22};It={x:1.946,y:2.896,z:-.536};Ht={x:.019,y:-.04,z:-.22};Et={x:1.793,y:3.11,z:-.536};Wt=!1;Ut={x:0,y:.23,z:-.18};Zt={x:-1.547,y:0,z:0};Kt={x:.0199,y:0,z:-.2599};Vt={x:1.4865,y:.4444,z:-2.9883};grenadeShape;Jt;Qt;qt=1.1;Xt=1;$t=60;ti=12;ii=!1;si=null;hi=new BABYLON.Vector3;ei=!1;ni=!1;oi=!1;ai;li;ri=new BABYLON.Vector3;mi=!1;Bi=!1;wi;ui=Date.now();Ai;ci=[];di;pi=new Ammo.btTransform;Li=!1;Oi=Date.now();fi="idle0";gi=[];Ni;Yi=!1;yi={meshes:[]};constructor(t,i,s){if((c=t).setRenderingAutoClearDepthStencil(1,!1,!0,!1),c.setRenderingAutoClearDepthStencil(2,!1,!0,!1),r=s,this.A=i,(m=new BABYLON.TerrainMaterial("terrainMaterial",c)).specularColor=new BABYLON.Color3(.5,.5,.5),m.specularPower=64,m.mixTexture=new BABYLON.Texture("textures/mixMap.png",c),m.diffuseTexture1=new BABYLON.Texture("textures/floor.png",c),m.diffuseTexture2=new BABYLON.Texture("textures/rock.png",c),m.diffuseTexture3=new BABYLON.Texture("textures/grass.png",c),m.bumpTexture1=new BABYLON.Texture("textures/floor_bump.png",c),m.bumpTexture2=new BABYLON.Texture("textures/rockn.png",c),m.bumpTexture3=new BABYLON.Texture("textures/grassn.png",c),m.diffuseTexture1.uScale=m.diffuseTexture1.vScale=10,m.diffuseTexture2.uScale=m.diffuseTexture2.vScale=10,m.diffuseTexture3.uScale=m.diffuseTexture3.vScale=10,fetch("particles/systems/linearFire.json").then((t=>t.text())).then(this.vi.bind(this)),fetch("particles/systems/explosion.json").then((t=>t.text())).then(this.bi.bind(this)),this.u=BABYLON.Mesh.CreateBox("skyBox",2e3,c),!this.debug){var h=new BABYLON.StandardMaterial("skyBox",c);h.backFaceCulling=!1,h.reflectionTexture=new BABYLON.CubeTexture("textures/TropicalSunnyDay",c),h.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,h.diffuseColor=new BABYLON.Color3(0,0,0),h.specularColor=new BABYLON.Color3(0,0,0),h.disableLighting=!0,this.u.material=h}this.yt=new BABYLON.HighlightLayer("hl1",c,{_i:!1}),this.yt.ki=!1,this.L=BABYLON.MeshBuilder.CreateBox("outer",{width:.6,depth:.6,height:2,updatable:!0},c),this.debug?(this.xi=new BABYLON.ArcRotateCamera("camera1",Math.PI/2,Math.PI/4,5,new BABYLON.Vector3(0,1,0),c),this.xi.attachControl(this.A,!0),this.xi.lowerRadiusLimit=2,this.xi.upperRadiusLimit=10,this.xi.wheelDeltaPercentage=.01):this.xi=new BABYLON.UniversalCamera("camera1",new BABYLON.Vector3(0,2,-3),c),this.xi.attachControl(this.A,!0);let e=new BABYLON.Texture("./textures/decal-diffuse.png",c);this.di=new BABYLON.StandardMaterial("decalMat",c),this.di.diffuseTexture=e,this.di.diffuseColor=new BABYLON.Color3(0,0,0),this.di.diffuseTexture.hasAlpha=!0,this.di.zOffset=-2,this.Mi(),this.Pi()}Ci(){}bi(t){A=JSON.parse(t)}vi(t){this.l=JSON.parse(t)}Ri(t){if(null!=this.meshes)for(let t=0,i=this.meshes.length;t<i;t++){const i=this.meshes[t],s=i.metadata.physicsBody,h=s.getMotionState();if(h){h.getWorldTransform(this.pi);const t=this.pi.getOrigin(),e=this.pi.getRotation();if("barrel"==i.metadata.tag)if(this.Wt)this.Wt=!1,s.setLinearVelocity(new Ammo.btVector3(0,0,0)),s.setLinearVelocity(new Ammo.btVector3(0,10,0));else{i.position.copyFrom(new BABYLON.Vector3(t.x(),t.y(),t.z()));let s=new BABYLON.Quaternion(e.x(),e.y(),e.z(),1);i.rotation.copyFrom(s)}else{i.position.copyFrom(new BABYLON.Vector3(t.x(),t.y(),t.z()));let s=new BABYLON.Quaternion(e.x(),e.y(),e.z(),1);i.rotation.copyFrom(s)}}}}Ti(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","Grenade-soviet-low2.glb",c).then((t=>{this.H=t;for(let t in this.H.meshes)this.H.meshes[t].position.y-=1,this.H.meshes[t].rotationQuaternion=null;this.H.meshes[0].id="__tgrenade1__",this.H.meshes[1].id="__tgrenadeshape1__",this.H.meshes[0].name="__tgrenade1__",this.H.meshes[1].name="__tgrenadeshape1__"}))}Si(){var t=this.B.length;if(3!=t)if(this.Z){var i=this.zi.meshes[1].createInstance("ai"+t,t);i.rotation.z+=Math.PI/1.5,i.attachToBone(this.m[t],this.zt[0]),this.it.push({type:"instance",meshes:i}),this.B.push(0)}else BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","Grenade-soviet-low1.glb",c).then((t=>{this.zi=t,this.it.push({type:"array",meshes:[this.zi.meshes[0],this.zi.meshes[1]]});let i=new BABYLON.Vector3(this.Ft.x,this.Ft.y,this.Ft.z),s=new BABYLON.Quaternion(this.Gt.x,this.Gt.y,this.Gt.z,1);this.Z=!0;for(let t in this.zi.meshes)this.zi.meshes[t].attachToBone(this.Rt,this.zt[0]),this.zi.meshes[t].position.copyFrom(i),this.zi.meshes[t].rotationQuaternion=null,this.zi.meshes[t].rotation.copyFrom(s);this.zi.meshes[0].id="__tgrenade__",this.zi.meshes[1].id="__tgrenadeshape__",this.zi.meshes[0].name="__tgrenade__",this.zi.meshes[1].name="__tgrenadeshape__"}))}Di(t,i,s,h){for(var e=new Float32Array(t*i),n=h-s,o=t/2,a=i/2,l=0,r=0;r<i;r++)for(var m=0;m<t;m++){var B=Math.sqrt(Math.pow((m-o)/o,2)+Math.pow((r-a)/a,2)),w=.5*(Math.sin(12*B)+1)*n+s;e[l]=w,l++}return e}async Fi(t){const i=new Ammo.btHeightfieldTerrainShape(150,150,undefined,1,-2,2,1,"PHY_FLOAT",!1);i.setMargin(0);let s=new Ammo.btTransform;s.setIdentity();let h=new Ammo.btVector3(0,0,0),e=new Ammo.btDefaultMotionState(s),n=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(0,e,i,h));t.metadata={physicsBody:null,tag:"ground",_callback:null,collisionCount:0,_sound:null,_soundExplosion:null},n.objectMesh=t,t.metadata.physicsBody=n,t.metadata.physicsBody.objectMesh=t,window.ammoPlugin.world.addRigidBody(n),this.meshes.push(t)}Gi(){(n=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("gui")).background="rgba(0,0,0,0.8)";var t=BABYLON.GUI.Button.CreateSimpleButton("btn","START");t.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,t.widthInPixels=200,t.heightInPixels=40,t.color="white",t.background="green",n.addControl(t),t.onPointerClickObservable.add((()=>{document.body.requestPointerLock()}))}Pi(){this.Gi();for(var t=-1;t<2;t++)for(var i=-1;i<2;i++)this.ji(t,i)}ji(t,i){let s=BABYLON.MeshBuilder.CreateGroundFromHeightMap("ground","./textures/patterns5.png",{width:150,height:150,subdivisions:100,updatable:!0,maxHeight:2,minHeight:-2,onReady:()=>{s.position.copyFrom(new BABYLON.Vector3(150*i,0,150*t)),s.material=m,this.Ii(s,new BABYLON.Vector3(150*i,0,150*t),0),1==t&&1==i&&this.Hi()}},c)}Ei(t,i,s,h){let e=t[1].getVerticesData(BABYLON.VertexBuffer.PositionKind),n=(t[1].getVerticesData(BABYLON.VertexBuffer.NormalKind),t[1].getVerticesData(BABYLON.VertexBuffer.ColorKind),t[1].getVerticesData(BABYLON.VertexBuffer.UVKind),t[1].getIndices());t[1].updateFacetData();var o=t[1].getFacetLocalPositions().length;let a=new Ammo.btTriangleMesh;new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0);for(var l=0;l<o;){var r=l++,m=n[3*r],B=n[3*r+1],w=n[3*r+2],u=new Ammo.btVector3(e[3*m],e[3*m+1],e[3*m+2]),A=new Ammo.btVector3(e[3*B],e[3*B+1],e[3*B+2]),c=new Ammo.btVector3(e[3*w],e[3*w+1],e[3*w+2]);a.addTriangle(u,A,c)}let d=new Ammo.btBvhTriangleMeshShape(a,!0,!0),p=new Ammo.btVector3(0,0,0);d.calculateLocalInertia(h,p),d.setMargin(0);let L=new Ammo.btTransform;L.setIdentity(),L.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));let O=new Ammo.btDefaultMotionState(L),f=new Ammo.btRigidBodyConstructionInfo(h,O,d,p),g=new Ammo.btRigidBody(f);for(let i in t)t[i].metadata={physicsBody:null},t[i].rotationQuaternion=null,t[i].metadata.physicsBody=g;window.ammoPlugin.world.addRigidBody(g),this.meshes.push(t[0])}Ii(t,i,s,h=new Ammo.btVector3(0,0,0)){let e=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),n=(t.getVerticesData(BABYLON.VertexBuffer.NormalKind),t.getVerticesData(BABYLON.VertexBuffer.ColorKind),t.getVerticesData(BABYLON.VertexBuffer.UVKind),t.getIndices());t.updateFacetData();var o=t.getFacetLocalPositions().length;let a=new Ammo.btTriangleMesh;new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0);for(var l=0;l<o;){var r=l++,m=n[3*r],B=n[3*r+1],w=n[3*r+2],u=new Ammo.btVector3(e[3*m],e[3*m+1],e[3*m+2]),A=new Ammo.btVector3(e[3*B],e[3*B+1],e[3*B+2]),c=new Ammo.btVector3(e[3*w],e[3*w+1],e[3*w+2]);a.addTriangle(u,A,c)}let d=new Ammo.btBvhTriangleMeshShape(a,!0,!0);d.setMargin(0);let p=new Ammo.btVector3(0,0,0),L=new Ammo.btTransform;L.setIdentity(),L.setOrigin(new Ammo.btVector3(i.x,i.y,i.z));let O=t.rotationQuaternion||new BABYLON.Quaternion.RotationYawPitchRoll(t.rotation.x,t.rotation.y,t.rotation.z);L.setRotation(new Ammo.btQuaternion(O.x,O.y,O.z,O.w));let f=new Ammo.btDefaultMotionState(L),g=new Ammo.btRigidBodyConstructionInfo(s,f,d,p),N=new Ammo.btRigidBody(g);t.metadata={physicsBody:null,tag:"ground",_callback:null,collisionCount:0,_sound:null,_soundExplosion:null},N.objectMesh=t,t.metadata.physicsBody=N,t.metadata.physicsBody.objectMesh=t,window.ammoPlugin.world.addRigidBody(N),this.meshes.push(t)}Wi(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","table-wooden-low7.glb",c).then((t=>{this.Ui=t;let i=this.Ui.meshes[1]._boundingInfo.boundingBox.maximum,s=this.Ui.meshes[1]._boundingInfo.boundingBox.minimum;Math.abs(i.y),Math.abs(s.y),Math.abs(i.x),Math.abs(s.x),Math.abs(i.z),Math.abs(s.z);this.Zi(this.Ui.meshes[1],"mesaShape");new Ammo.btBoxShape(new Ammo.btVector3(1,1.4,1));this.Ki(this.Ui.meshes[0],"mesa",{x:5,y:-.15,z:5},this.mesaShape,0,{velocity:0,direction:{x:0,y:0,z:0},damping:[1,1],friction:200,margin:.1}),BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","Grenade-soviet-low.glb",c).then((t=>{this.Vi=t,this.Ji.attachToMesh(this.Vi.meshes[0]),this.Vi.meshes[0].id="_rootgrenade_",this.Vi.meshes[0].name="_rootgrenade_",this.Vi.meshes[1].id="_shapegrenade_",this.Vi.meshes[1].name="_shapegrenade_",this.Zi(this.Vi.meshes[1],"grenadeShape");for(let t in this.Vi.meshes)this.Vi.meshes[t].rotationQuaternion=null;setTimeout((function(t){}),3e3,this);let i=this.Ui.meshes[0].position;this.Vi.meshes[0].position.copyFrom(new BABYLON.Vector3(i.x,i.y+1.2,i.z)),this.Ui.meshes[0].addChild(this.Vi.meshes[0]),this.Ui.meshes[0].addChild(this.Vi.meshes[1]),setTimeout((function(t){}),2e4,this)}))}))}Hi(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","cube-wall.glb",c).then((t=>{this.Qi=t;let i=this.Qi.meshes[1]._boundingInfo.boundingBox.maximum,s=this.Qi.meshes[1]._boundingInfo.boundingBox.minimum,h=Math.abs(i.y)+Math.abs(s.y),e=Math.abs(i.x)+Math.abs(s.x)+2,n=Math.abs(i.z)+Math.abs(s.z),o=new Ammo.btBoxShape(new Ammo.btVector3(e/2,h,n/2));this.Ki(this.Qi.meshes[0],"wall",{x:15,y:0,z:-30},o,0,{velocity:1,direction:{x:1,y:1,z:1},damping:[.1,.1],friction:.6,margin:.2})})),this.Wi();BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","barrel-mixed-low2.glb",c).then((t=>{this.qi=t;let i=BABYLON.MeshBuilder.CreateSphere("explosionzone",{diameter:.1});i.isVisible=!1,this.qi.meshes[1].addChild(i),i.position.copyFrom(new BABYLON.Vector3(0,this.qi.meshes[1]._boundingInfo.boundingSphere.radius+1,0)),this.Zi(this.qi.meshes[1],"barrelShape"),this.Ki(this.qi,"barrel",{x:0,y:5,z:15},this.barrelShape,50,{velocity:0,direction:{x:0,y:0,z:0},damping:[0,0],friction:.1,margin:.1})})),this.Xi()}$i(t,i){this.xi.animations=[this.ts({property:"position",from:this.xi.position,to:t,_callback:i})]}ss(t){const i=t%(2*Math.PI);return i<0?i+BABYLON.Tools.ToRadians(360):i}hs(t){}ts({property:t,from:i,to:s,_callback:h}){const e=new BABYLON.CubicEase,n=(new BABYLON.Node("node",c),BABYLON.Animation.CreateAndStartAnimation("at4",this.xi,"position",300,30,i,s,0,e,(function(t){h()})));return n.es=!0,n}Xi(){(new Ammo.btTransform).setIdentity();this.L.position.x,this.L.position.y,this.L.position.z;this.L.metadata={tag:"",objectMesh:null},this.L.metadata.tag="player",this.L.position.copyFrom(new BABYLON.Vector3(0,2,0));new BABYLON.Vector3(this.L.position.x,this.L.position.y-1,this.L.position.z-3);this.L.isVisible=!1,this.L.isPickable=!1,this.L.checkCollisions=!0,this.ns=BABYLON.MeshBuilder.CreateBox("cubeCam",{width:.2,depth:.2,height:.2,updatable:!0},c),this.ns.isVisible=!1,BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","v6.glb",c).then((t=>{this.os=t,this.zt=t.meshes,this.ls.attachToMesh(this.os.meshes[0]),this.rs.attachToMesh(this.os.meshes[0]),this.ct=t.transformNodes[63];t.animationGroups;c.Bs=()=>this.L.absolutePosition;let i=t.skeletons[0];this.Rt=i.bones[53],this.ws=i.bones[56],this.m.push(i.bones[69]),this.m.push(i.bones[70]),this.m.push(i.bones[71]),this.m.push(i.bones[72]);let s=new BABYLON.Vector3(0,0,0);s.add(this.L.forward),s.scaleInPlace(this.Xt+this.ti),this.ri.copyFrom(s),this.us(),this.ot=["idle0","crosshair","crosshairwalk","jump","walk","run","prethrow","throw","prethrowpose","pickitem","pickitembackpack"],this.animations.idle0=this.os.animationGroups[4],this.animations.crosshair=this.os.animationGroups[3],this.animations.crosshairwalk=this.os.animationGroups[11],this.animations.jump=this.os.animationGroups[6],this.animations.walk=this.os.animationGroups[10],this.animations.jump.speedRatio=.8,this.animations.run=this.os.animationGroups[9],this.animations.prethrow=this.os.animationGroups[1],this.animations.prethrowpose=this.os.animationGroups[2],this.animations.pickitem=this.os.animationGroups[7],this.animations.pickitem.speedRatio=.5,this.animations.pickitembackpack=this.os.animationGroups[8],this.animations.throw=this.os.animationGroups[0],this.animations.As=this.os.animationGroups[12];for(let t in this.ot){let i=this.ot[t];this.animations[i].setWeightForAllAnimatables(0),this.animations[i].play(!0),this.animations[i].normalize()}this.animations.idle0.setWeightForAllAnimatables(1),this.rt=this.animations.idle0,this.Bt=this.animations.idle0,this.et="idle0",this.nt="idle0",this.Li=!0;t.meshes[0];const e=new Ammo.btCapsuleShape(.3,1.5);B=new Ammo.btPairCachingGhostObject;const n=new Ammo.btTransform;n.setIdentity(),n.setOrigin(new Ammo.btVector3(0,5,0)),n.setRotation(new Ammo.btQuaternion(0,0,Math.PI/2,0)),B.objectMesh={metadata:{tag:"player"}},B.setWorldTransform(n),B.setCollisionShape(e),B.setCollisionFlags(32),B.setActivationState(4),B.activate(!0),B.setAnisotropicFriction(0),B.setCcdMotionThreshold(0),B.setContactProcessingThreshold(0),B.setFriction(1),B.setRollingFriction(1),(u=new Ammo.btKinematicCharacterController(B,e,.1,1)).setGravity(9.81),u.canJump(),u.setMaxJumpHeight(1.3),u.setJumpSpeed(4),u.setUpInterpolate(!1),u.setUseGhostSweepTest(!1);const o=c.getPhysicsEngine().getPhysicsPlugin().world;o.addCollisionObject(B,32,3),o.addAction(u),(h=this.os.meshes[0]).parent=this.L,h.position=new BABYLON.Vector3(0,-1,0),h.isPickable=!1,h.getChildMeshes().forEach((t=>{t.isPickable=!1}));setTimeout((function(t){t.xi.setTarget(t.L.absolutePosition)}),1e4,this),w=B.getWorldTransform()})),this.xi.parent=this.L,this.xi.position.y=this.L.absolutePosition.y+.5,this.cs(),this.ds()}ps(t,i){t.bakeCurrentTransformIntoVertices();let s=t.getVerticesData(BABYLON.VertexBuffer.PositionKind);var h=new Ammo.btHeightfieldTerrainShape(150,150,s,1,-2,2,1,"PHY_FLOAT",!1);let e=new Ammo.btTransform;e.setIdentity(),e.setOrigin(new Ammo.btVector3(0,0,0));let n=new Ammo.btVector3(0,0,0),o=new Ammo.btDefaultMotionState(e),a=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(0,o,h,n));window.ammoPlugin.world.addRigidBody(a)}us(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","chaleco2.glb",c).then((t=>{this.Ls=t,this.st.idle0=this.Ls.animationGroups[4],this.st.crosshair=this.Ls.animationGroups[3],this.st.crosshairwalk=this.Ls.animationGroups[11],this.st.jump=this.Ls.animationGroups[5],this.st.jump.speedRatio=.8,this.st.walk=this.Ls.animationGroups[10],this.st.run=this.Ls.animationGroups[9],this.st.prethrow=this.Ls.animationGroups[1],this.st.prethrowpose=this.Ls.animationGroups[2],this.st.pickitem=this.Ls.animationGroups[6],this.st.pickitem.speedRatio=.5,this.st.pickitembackpack=this.Ls.animationGroups[7],this.st.throw=this.Ls.animationGroups[0],this.st.As=this.Ls.animationGroups[12];for(let t in this.ot){let i=this.ot[t];this.animations[i].reset(),this.st[i].reset(),this.st[i].setWeightForAllAnimatables(0),this.st[i].play(!0),this.st[i].normalize()}this.st.idle0.setWeightForAllAnimatables(1),this.Ls.meshes[0].parent=this.L,this.Ls.meshes[0].position=new BABYLON.Vector3(0,-1,0),this.W=!0})),BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","sks3.glb",c).then((t=>{let i=t;this.Qt=t.transformNodes[0],this.St=t.meshes,this.ai.attachToMesh(i.meshes[0]),this.Os.attachToMesh(i.meshes[0]);let s=this.zt[0],h=new BABYLON.Vector3(this.jt.x,this.jt.y,this.jt.z),e=new BABYLON.Quaternion(this.It.x,this.It.y,this.It.z,1);this.lt=!0;for(let t in this.St)this.St[t].attachToBone(this.Rt,s),this.St[t].position.copyFrom(h),this.St[t].rotation.copyFrom(e);this.fs(),setTimeout((function(t){r.hideLoadingUI(),t.Dt=!0}),5e3,this)}))}Mi(){this.Ji=new BABYLON.Sound("soundGrenadePick","sounds/grenade-pick.ogg",c,null,{loop:!1,autoplay:!1,volume:.1}),this.gs=new BABYLON.Sound("soundGrenadeCollision","sounds/grenade-collision.ogg",c,null,{loop:!1,autoplay:!1,volume:.1}),this.ai=new BABYLON.Sound("soundZoom","sounds/zoom-add.ogg",c,null,{loop:!1,autoplay:!0,volume:1}),this.ls=new BABYLON.Sound("soundWalk","sounds/walking.ogg",c,null,{loop:!0,autoplay:!1,volume:.5}),this.rs=new BABYLON.Sound("soundRun","sounds/running.ogg",c,null,{loop:!0,autoplay:!1,volume:.5}),this.Os=new BABYLON.Sound("soundPickGun","sounds/pick-gun.wav",c,null,{loop:!1,autoplay:!1,volume:.5}),this.li=new BABYLON.Sound("soundFireBurn","sounds/fire-burn.wav",c,null,{loop:!0,autoplay:!1,volume:.1}),this.Ns=new BABYLON.Sound("soundGunShot","sounds/gunshot-short.ogg",c,null,{loop:!1,autoplay:!1,volume:.8}),this.Ys=new BABYLON.Sound("soundExplosion","sounds/boom.wav",c,null,{loop:!1,autoplay:!1,volume:1}),BABYLON.Engine.audioEngine.setGlobalVolume(1)}ys(){!this.Yi&&this.oi&&(this.Ns.isPlaying?(this.Ns.stop(),this.Ns.play()):this.Ns.play(),this.vs())}async bs(){if(this.i=c.getEngine().getDeltaTime()/1e3,this.Dt){var t=u.getGhostObject().getWorldTransform(),i=(t.getOrigin(),t.getRotation()),s=new BABYLON.Vector3(t.getOrigin().x(),t.getOrigin().y(),t.getOrigin().z());if(this.L.position=s,this.L.rotationQuaternion||(this.L.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(this.L.rotation.x,this.L.rotation.y,this.L.rotation.z)),this.L.rotationQuaternion.set(i.w(),i.x(),i.y(),i.z()),this.$.w){this.Bi=!0;const t=w.getBasis().getRow(2);this.wi=new Ammo.btVector3(t.x(),0,t.z()).op_mul(this.Lt/1.5)}this.L.intersectsMesh(c.getMeshByName("ground"))&&(this.At||(this.wt&&(this.wt=!1,this.ut=!1),this.At=!0),this.g=Date.now()),this.$.w||(this.wi=new Ammo.btVector3(0,0,0)),u.setWalkDirection(this.wi)}if(this.Mt){if(this.ni)return;if(!this.oi){if(this.Yi)return;return this.M=!0,void await this._s(this.i)}}else this.M=!1,this.oi&&!this.ni&&this.ks()}ks(){this.ei||this.ni||(this.oi&&(this.ni=!0),this.ii||(this.$i(this.hi,this.onCompleteLoadingCrosshairHide.bind(this)),this.si=null,this.oi=!1,document.getElementById("crosshair").style.display="none"))}async _s(t){var i=new BABYLON.Vector3;if(i.copyFrom(this.xi.position),i.x-=.5,i.z+=.1,!this.ei&&(this.hi.copyFrom(this.xi.position),!this.ni)){if(this.oi||(this.ni=!0),null==this.si){if(this.si=this.xi.rotation,this.ii)return;if(this.ei)return;this.$i(new BABYLON.Vector3(this.xi.position.x+.5,this.xi.position.y,this.xi.position.z+.5),this.xs.bind(this))}document.getElementById("crosshair").style.display="block"}}async Ms(){let t=Date.now();if(t-this.Oi>12e3){let i=Math.floor(1*Math.random());return this.Oi=t,this.fi="idle"+i,"idle"+i}return this.fi}Ps(){let t=this.zi.meshes[1].createInstance("o",l);l++;var i=c.pick(window.innerWidth/2,window.innerHeight/2);i.ray.origin,new BABYLON.Vector3(this.L.absolutePosition.x,this.L.absolutePosition.y+1.4,this.L.absolutePosition.z);let s=i.ray.direction;this.Ki(t,"grenadethrow",{x:this.L.position.x,y:this.L.position.y+1.5,z:this.L.position.z},this.grenadeShape,.5,{velocity:22,direction:{x:s.x,y:s.y,z:s.z},damping:[.1,.1],friction:1,margin:.3});new BABYLON.Vector3(s.x,s.y,s.z).scaleInPlace(23);let h=this.it[this.B.length];if("instance"==h.type)c.removeMesh(h.meshes);else for(let t in h.meshes)c.removeMesh(h.meshes[t]);1==this.it.length?(this.it=[],this.Z=!1):(this.it.pop(),this.B.pop())}Cs(){let t=new BABYLON.Vector3(this.jt.x,this.jt.y,this.jt.z),i=new BABYLON.Quaternion(this.It.x,this.It.y,this.It.z,1);for(let s in this.St)this.St[s].position.copyFrom(t),this.St[s].rotation.copyFrom(i)}Rs(){let t=new BABYLON.Vector3(this.Ht.x,this.Ht.y,this.Ht.z),i=new BABYLON.Quaternion(this.Et.x,this.Et.y,this.Et.z,1);for(let s in this.St)this.St[s].position.copyFrom(t),this.St[s].rotation.copyFrom(i)}Ts(){let t=new BABYLON.Vector3(this.Ut.x,this.Ut.y,this.Ut.z),i=new BABYLON.Quaternion(this.Zt.x,this.Zt.y,this.Zt.z,1);for(let s in this.St)this.St[s].attachToBone(this.ws,this.zt[0]),this.St[s].position.copyFrom(t),this.St[s].rotation.copyFrom(i)}Ss(){let t=new BABYLON.Vector3(this.jt.x,this.jt.y,this.jt.z),i=new BABYLON.Quaternion(this.It.x,this.It.y,this.It.z,1);for(let s in this.St)this.St[s].attachToBone(this.Rt,this.zt[0]),this.St[s].position.copyFrom(t),this.St[s].rotation.copyFrom(i)}async zs(){if(this.Dt){if(this.$.shift||this.ut||this.wt||!this.$.w)if(this.$.shift&&this.$.w&&!this.ut&&!this.wt)this.Mt?(this.Bt=this.animations.crosshairwalk,this.et="crosshairwalk",this.Lt=this.ft,this.rs.isPlaying?(this.rs.stop(),this.ls.isPlaying||this.ls.play(!0)):this.ls.isPlaying||this.ls.play(!0)):(this.Bt=this.animations.run,this.Lt=this.Ot,this.et="run");else if(!this.wt||this.ut||this.$.shift)if(!this.ut&&this.Ds){let t=await this.Ms();this.Bt=this.animations[t],this.Lt=this.ft,this.et=t,this.ls.isPlaying&&this.ls.stop(),this.rs.isPlaying&&this.rs.stop()}else if(this.ut)this.Bt=this.animations.jump,this.et="jump",this.Lt=this.ft,this.ls.isPlaying&&this.ls.stop(),this.rs.isPlaying&&this.rs.stop();else if(this.ls.isPlaying&&this.ls.stop(),this.rs.isPlaying&&this.rs.stop(),this.M||this.ei)this.Bt=this.animations.crosshair,this.et="crosshair";else if(this.Z&&this.N)if(this.k){if(Date.now()-this.q>1600){if(this.Bt.isPlaying){this.dt=!0,document.getElementById("crosshair").style.display="block";for(let t in this.animations)this.animations[t].setWeightForAllAnimatables(0),this.st[t].setWeightForAllAnimatables(0);this.Bt=this.animations.prethrowpose,this.et="prethrowpose",this.Bt.setWeightForAllAnimatables(1),this.st[this.et].setWeightForAllAnimatables(1),this._t=!1,this.rt=this.Bt,this.nt=this.et,this.kt=0,this.xt=1}}else this.Bt=this.animations.prethrow,this.et="prethrow"}else this.q=Date.now(),this.k=!0,this.et="prethrow",this.animations.prethrow.restart(),this.animations.prethrow.stop(),this.animations.prethrow.start(!0),this.st.prethrow.restart(),this.st.prethrow.stop(),this.st.prethrow.start(!0),this.Bt=this.animations.prethrow,this.Lt=this.ft;else if(this.dt)if(this.T){if(Date.now()-this.U>1600){if(this.Bt.isPlaying){this.dt=!1,this.k=!1,this.T=!1,document.getElementById("crosshair").style.display="none";for(let t in this.animations)this.animations[t].setWeightForAllAnimatables(0),this.st[t].setWeightForAllAnimatables(0);this.Bt=this.animations.idle0,this.et="idle0",this.Bt.setWeightForAllAnimatables(1),this.st[this.et].setWeightForAllAnimatables(1),this._t=!1,this.rt=this.Bt,this.nt=this.et,this.kt=0,this.xt=1}}else this.et="throw",this.Bt=this.animations.throw,this.Lt=this.ft}else this.U=Date.now(),this.T=!0,this.Ps(),this.animations.throw.restart(),this.animations.throw.stop(),this.animations.throw.start(!0),this.st.throw.restart(),this.st.throw.stop(),this.st.throw.start(!0),this.et="throw",this.Bt=this.animations.throw,this.Lt=this.ft;else if(this.$.f&&this.p)if(this.mi){if(Date.now()-this.ui>900){if(this.Bt.isPlaying){this.Ji.play(),this.mi=!1;for(let t in this.animations)this.animations[t].setWeightForAllAnimatables(0),this.st[t].setWeightForAllAnimatables(0);this.Bt=this.animations.idle0,this.et="idle0",this.Bt.setWeightForAllAnimatables(1),this.st[this.et].setWeightForAllAnimatables(1),this._t=!1,this.rt=this.Bt,this.nt=this.et,this.kt=0,this.xt=1,this.$.f=!1}}else this.Bt=this.animations.pickitem,this.et="pickitem"}else this.Si(),this.ui=Date.now(),this.mi=!0,this.animations.pickitem.stop(),this.animations.pickitem.restart(),this.animations.pickitem.start(!0),this.st.pickitem.stop(),this.st.pickitem.restart(),this.st.pickitem.start(!0),this.et="pickitem",this.Bt=this.animations.pickitem,this.Lt=this.ft;else if(this.$.f&&!this.p)if(this.C){if(Date.now()-this.P>500&&this.Bt.isPlaying){this._t=!1,this.C=!1,this.Yi?(this.Ss(),this.Yi=!1):(this.Ts(),this.Yi=!0);for(let t in this.animations)this.st[t].setWeightForAllAnimatables(0),this.animations[t].setWeightForAllAnimatables(0);this.Bt=this.animations.idle0,this.et="idle0",this.Bt.setWeightForAllAnimatables(1),this.st[this.et].setWeightForAllAnimatables(1),this.kt=0,this.xt=1,this.Bt.syncAllAnimationsWith(null),this.st[this.et].syncAllAnimationsWith(null),this.rt.syncAllAnimationsWith(this.Bt.animatables[0]),this.st[this.nt].syncAllAnimationsWith(this.st[this.et].animatables[0]),this.Bt.setWeightForAllAnimatables(1),this.st[this.et].setWeightForAllAnimatables(1),this.rt.setWeightForAllAnimatables(0),this.st[this.nt].setWeightForAllAnimatables(0),this.Bt.normalize(),this.st[this.et].normalize(),this.rt=this.Bt,this.nt=this.et,this.$.f=!1}}else this.P=Date.now(),this.C=!0,this.Os.play(!0),this.animations.pickitembackpack.stop(),this.animations.pickitembackpack.restart(),this.animations.pickitembackpack.start(!0),this.st.pickitembackpack.stop(),this.st.pickitembackpack.restart(),this.st.pickitembackpack.start(!0),this.et="pickitembackpack",this.Bt=this.animations.pickitembackpack,this.Lt=this.ft;else{this.rt,this.ls.isPlaying&&this.ls.stop(),this.rs.isPlaying&&this.rs.stop();let t=await this.Ms();this.et=t,this.Bt=this.animations[t],this.Lt=this.ft}else this.Bt=this.animations.jump,this.et="jump",this.ls.isPlaying&&this.ls.stop(),this.rs.isPlaying&&this.rs.stop();else this.Mt?(this.Bt=this.animations.crosshairwalk,this.et="crosshairwalk",this.Lt=this.ft):(this.Bt=this.animations.walk,this.Lt=this.ft,this.et="walk");null!=this.Bt&&this.rt!==this.Bt&&(this._t=!0)}}Fs(t,i){let s=1,h=0;i.Gs;for(let e=0;e<=1;e+=.08)h+=.002,s-=.002,i.setWeightForAllAnimatables(h),t.setWeightForAllAnimatables(s)}js(){for(let i=0;i<this.ci.length;i++){let s=this.ci[i];if(s.intersectsMesh(c.getMeshByName("platform1"))||s.intersectsMesh(c.getMeshByName("Cylinder"))||s.intersectsMesh(c.getMeshByName("ground"))){let h=s.metadata,e=h.sourceMesh,n=h.position,o=h.normal,a=0,l=!0;var t=new BABYLON.Vector3(.25,.25,.25);BABYLON.MeshBuilder.CreateDecal("decal",e,{position:n,normal:o,angle:a,size:t,cullBackFaces:l,localMode:!0}).material=this.di,this.Is(e),c.removeMesh(s),this.li.attachToMesh(e),this.li.play(!0),this.ci=this.ci.filter(((t,s)=>t!=i))}}}fs(){this.Hs=new Ammo.ConcreteContactResultCallback,this.Hs.addSingleResult=function(t,i,s,h,e,n,o){if(Ammo.wrapPointer(t,Ammo.btManifoldPoint).getDistance()>0)return;let a=Ammo.wrapPointer(i,Ammo.btCollisionObjectWrapper),l=Ammo.castObject(a.getCollisionObject(),Ammo.btRigidBody),r=Ammo.wrapPointer(e,Ammo.btCollisionObjectWrapper),m=Ammo.castObject(r.getCollisionObject(),Ammo.btRigidBody),B=l.objectMesh,w=m.objectMesh;if(null!=B&&null!=w){let t=w.metadata.tag,i=B.metadata.tag;if(("player"==i||"player"==t)&&(this.At||(this.wt&&(this.wt=!1,this.ut=!1),this.At=!0),this.g=Date.now()),"grenadethrow"==i){if("ground"==t||"wall"==t){let t=B.metadata._sound;if(B.metadata.collisionCount<6){let i=Date.now();(i>B.metadata.Es+200||!B.metadata.Es)&&(B.metadata.Es=i,B.metadata.collisionCount+=1,B.metadata._sound.isPlaying?(t.stop(),t.play()):t.play())}}}else if("grenadethrow"==t&&("ground"==i||"wall"==i)){let t=w.metadata._sound;if(w.metadata.collisionCount<6){let i=Date.now();(i>w.metadata.Es+200||!w.metadata.Es)&&(w.metadata.Es=i,w.metadata.collisionCount+=1,w.metadata._sound.isPlaying?(t.stop(),t.play()):t.play())}}}}.bind(this)}Ws(t){const i=new t.ConcreteContactResultCallback;return i.Us=!1,i.addSingleResult=function(s,h,e,n,o,a,l){return t.wrapPointer(s,ammoInstance.btManifoldPoint).getDistance()>0?0:(i.Us=!0,1)},i}Zs(){if(this.Dt){if(this.R.length>0)for(let t in this.R)window.ammoPlugin.world.contactTest(this.R[t].metadata.physicsBody,this.Hs);if(u.onGround()&&(this.At||(this.wt&&(this.wt=!1,this.ut=!1),this.At=!0)),window.ammoPlugin.world.contactTest(B,this.Hs),null!=this.Ui&&null!=this.L){let t=this.Ui.meshes[0].position,i=this.L.position,s=new BABYLON.Vector3(t.x,t.y,t.z),h=new BABYLON.Vector3(i.x,i.y,i.z);if(BABYLON.Vector3.Distance(s,h)<2){if(this.O)return;null!=this.Vi&&(this.p=!0,this.yt.blurHorizontalSize=0,this.yt.blurVerticalSize=0,this.yt.addMesh(this.Vi.meshes[1],BABYLON.Color3.Green()),this.O=!0)}else null!=this.Vi&&(this.p=!1,this.yt.removeMesh(this.Vi.meshes[1]),this.O=!1)}}}ds(){c.registerBeforeRender((()=>{a.innerHTML="<b>FPS: "+r.getFps().toFixed()+"</b>",this.bs(),this.Ks(),this.zs(),this.Zs(),this.Ri()}))}Ks(){if(this._t)if(this.kt+=.5,this.xt-=.5,"Rig|Rig|jump0"==this.rt.name&&u.onGround())this.rt.setWeightForAllAnimatables(0),this.Bt.setWeightForAllAnimatables(1),this.W&&(this.st[this.nt].setWeightForAllAnimatables(0),this.st[this.et].setWeightForAllAnimatables(1)),this._t=!1,this.rt=this.Bt,this.nt=this.et,this.kt=0,this.xt=1;else{if(this.et==this.nt&&"Rig|Rig|Prethrow"!=this.Bt.name&&"Rig|Rig|Throw"!=this.Bt.name&&"Rig|Rig|PickItem"!=this.Bt.name&&"Rig|Rig|PickBackpack"!=this.Bt.name){this.W&&this.st[this.et].setWeightForAllAnimatables(1),this.animations[this.et].setWeightForAllAnimatables(1);for(let t=0;t<this.ot.length;t++)this.et!=this.ot[t]&&(this.animations[this.ot[t]].setWeightForAllAnimatables(0),this.W&&this.st[this.ot[t]].setWeightForAllAnimatables(0)),t==this.ot.length-1&&(this.rt=this.Bt,this.nt=this.et,this.kt=0,this.xt=1);return}if(this.Bt.syncAllAnimationsWith(null),this.rt.syncAllAnimationsWith(this.Bt.animatables[0]),this.Bt.setWeightForAllAnimatables(this.kt),this.rt.setWeightForAllAnimatables(this.xt),this.Bt.normalize(),this.W){let t=this.st[this.et],i=this.st[this.nt];t.syncAllAnimationsWith(null),i.syncAllAnimationsWith(t.animatables[0]),t.setWeightForAllAnimatables(this.kt),i.setWeightForAllAnimatables(this.xt)}if(this.kt>=1){this._t=!1,this.kt=1,this.xt=0,this.W&&(this.st[this.et].setWeightForAllAnimatables(this.kt),this.st[this.nt].setWeightForAllAnimatables(this.xt)),this.Bt.setWeightForAllAnimatables(this.kt),this.rt.setWeightForAllAnimatables(this.xt);for(let t=0;t<this.ot.length;t++)this.et!=this.ot[t]&&(this.animations[this.ot[t]].setWeightForAllAnimatables(0),this.W&&this.st[this.ot[t]].setWeightForAllAnimatables(0)),t==this.ot.length-1&&(this.rt=this.Bt,this.nt=this.et,this.kt=0,this.xt=1)}}else null!=this.Bt&&this.Bt.normalize()}async cs(){this.debug||document.addEventListener("pointerlockchange",this.Vs.bind(this),!1),document.addEventListener("pointermove",this.Js.bind(this)),document.addEventListener("keydown",this.Qs.bind(this)),document.addEventListener("keyup",this.qs.bind(this)),document.addEventListener("mousedown",this.Xs.bind(this)),document.addEventListener("mouseup",this.$s.bind(this)),document.addEventListener("wheel",this.th.bind(this))}async xs(){let t=new BABYLON.Vector3(this.Kt.x,this.Kt.y,this.Kt.z),i=new BABYLON.Quaternion(this.Vt.x,this.Vt.y,this.Vt.z,1);for(let s in this.St)this.St[s].position.copyFrom(t),this.St[s].rotation.copyFrom(i);if(this.ni=!1,this.oi=!0,this.ei){new BABYLON.Vector3(0,0,0).add(this.L.forward);var s=c.pick(window.innerWidth/2,window.innerHeight/2);let t=this.Xt+this.ti/10,i=new BABYLON.Vector3(this.xi.position.x,this.xi.position.y,this.xi.position.z+t);s.ray.origin._x,s.ray.direction._x,s.ray.origin._z,s.ray.direction._z;this.ri.copyFrom(i),this.xi.position.copyFrom(i)}}onCompleteLoadingCrosshairHide(){this.ni=!1,this.oi=!1;let t=new BABYLON.Vector3(this.jt.x,this.jt.y,this.jt.z),i=new BABYLON.Quaternion(this.It.x,this.It.y,this.It.z,1);for(let s in this.St)this.St[s].position.copyFrom(t),this.St[s].rotation.copyFrom(i)}th(t){if(this.ei){var i=c.pick(window.innerWidth/2,window.innerHeight/2);if(t.deltaY>0){if(1==this.Xt)return;this.ai.isPlaying||this.ai.play(),this.qt<1.1?this.qt+=.1:this.qt=1.1,this.Xt--;let t=(this.Xt+this.ti)/10,s=(this.xi.position.x,i.ray.direction.x,this.xi.position.z,i.ray.direction.z,new BABYLON.Vector3(this.xi.position.x,this.xi.position.y,this.xi.position.z-t));if(s.z<this.Qt.absolutePosition.z){new BABYLON.Vector3(s.x,this.Qt.absolutePosition.y,s.z);this.Xt=1}else this.xi.position.copyFrom(s)}else{if(this.Xt==this.$t)return;this.ai.isPlaying||this.ai.play(),this.qt>.1?this.qt-=.1:this.qt=.1,this.Xt++;let t=(this.Xt+this.ti)/10,s=(i.ray.origin.x,i.ray.direction.x,i.ray.origin.z,i.ray.direction.z,new BABYLON.Vector3(this.xi.position.x,this.xi.position.y,this.xi.position.z+t));this.xi.position.copyFrom(s)}}}$s(t){if(2==t.button){let t=Date.now();if(this.ei)return this.ei=!1,document.getElementById("sniper-crosshair-box").style.display="none",this.qt=1.1,void(this.Mt=!1);if((t-this.Pt)/60<11&&!this.ei){this.ei=!0,this.oi=!0,this.ni=!1,this.qt=.8;var i=new BABYLON.Vector3;i.add(this.L.forward),i.scaleInPlace(2),document.getElementById("sniper-crosshair-box").style.display="block"}this.Mt=!1}else 0==t.button&&(this.N=!1)}Xs(t){var i;if(this.Dt)if(("which"in(t=t||window.event)||"button"in e)&&(i=2==t.button),i)this.Mt=!0,this.qt=.8,this.Pt=Date.now();else if(0==t.button)if(this.N=!0,null==this.Ct)this.Ct=Date.now(),this.ys();else{var s=Date.now();s>this.Ct+0&&(this.ys(),this.Ct=s)}}ih(){}Vs(t){null==document.pointerLockElement?this.Gi():n.dispose()}qs(t){switch(this.Bi=!1,t.which){case 16:this.rs.isPlaying&&(this.rs.stop(),this.$.w&&this.ls.play(!1)),this.$.shift=!1,this.Yi||this.Cs();break;case 70:default:break;case 87:this.ls.isPlaying&&this.ls.stop(),this.rs.isPlaying&&this.rs.stop(),this.$.w=!1;break;case 32:this.$.tt=!1}}Qs(t){switch(this.Bi=!0,t.which){case 16:this.$.shift=!0,this.$.w&&(this.Yi||this.Rs(),this.ls.isPlaying&&this.ls.stop(),this.rs.isPlaying||this.rs.play(!1));break;case 70:this.$.f=!0;break;case 87:this.ls.isPlaying||this.ls.play(!1),this.$.w=!0;break;case 32:this.wt||(this.animations.jump.reset(),this.st.jump.reset(),this.At=!1,u.jump(),this.wt=!0,this.ut=!0),this.$.tt=!0}}jump(){this.At=!1,this.animations.jump.reset(),this.st.jump.reset();let t=this.L.forward,i=new BABYLON.Vector3(t.x/this.Lt,t.y/this.Lt,t.z/this.Lt);this.L.moveWithCollisions(i);this.L.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(this.L.forward.x+currentLinearVelocity._x,1,this.L.forward.z+currentLinearVelocity._z))}vs(){let t=this.Qt.absolutePosition;var i=c.pick(window.innerWidth/2,window.innerHeight/2);i.ray.origin.z+=3;let s,h=i.ray.direction;s=new BABYLON.Vector3(t.x,t.y,t.z);const e=this.xi.getForwardRay().direction.negateInPlace().normalize(),n=i.pickedPoint,o=i.pickedMesh;if(null==o)return;var a=new BABYLON.Vector3(.05,.05,.05);if("Cylinder"==o.name){this.Wt=!0,this.Is(o);Math.random(),h.x,Math.random(),Math.random(),h.z}BABYLON.MeshBuilder.CreateDecal("decal",o,{position:n,normal:e,angle:0,size:a,cullBackFaces:!0,localMode:!0}).material=this.di}sh(t){let i=BABYLON.ParticleSystem.Parse(t,c,"");i.disposeOnStop=!0,i.emitter=this,i.start(1)}Is(t){let i=t._children[0];A.systems.forEach(this.sh.bind(i));Math.random();t.metadata.physicsBody.applyImpulse(new Ammo.btVector3(0,100,0),new Ammo.btVector3(0,-5,0)),this.hh(t,i)}hh(t,i){null!=this.D&&this.D.dispose(),this.D=BABYLON.ParticleSystem.Parse(this.l,c,"");let s=this.Ys.clone();this.li.isPlaying||(this.li.attachToMesh(t),this.li.play(!0)),s.attachToMesh(t),s.play(!0),setTimeout((function(t,i){t.emitter=i,t.start(1)}),1500,this.D,i)}eh(){setTimeout((function(t){t.metadata._soundExplosion.play(!0),A.systems.forEach((i=>{let s=BABYLON.ParticleSystem.Parse(i,c,"");s.disposeOnStop=!0,s.emitter=t,s.start(1);Math.random();setTimeout((function(t){t.metadata.physicsBody.applyImpulse(new Ammo.btVector3(0,2,0),new Ammo.btVector3(0,-5,0))}),600,t)}))}),5e3,this)}nh(t,i,s,h=1,e="sphere",n=1,o=1,a={x:0,y:0,z:0}){let l=null;l=new Ammo.btSphereShape(n);const r=new Ammo.btVector3(0,0,0);l.calculateLocalInertia(h,r),l.setMargin(0);const m=new Ammo.btTransform;m.setIdentity(),m.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const B=new Ammo.btDefaultMotionState(m),w=new Ammo.btRigidBodyConstructionInfo(h,B,l,r),u=new Ammo.btRigidBody(w);let A=new BABYLON.Vector3(a.x,a.y,a.z);A.scaleInPlace(o),u.setFriction(100),u.setDamping(.5,.5),u.setLinearVelocity(new Ammo.btVector3(A.x,A.y,A.z)),t.metadata={physicsBody:null,tag:i,_callback:null,collisionCount:0,_sound:null,_soundExplosion:null},t.metadata.physicsBody=u,u.objectMesh=t,window.ammoPlugin.world.addRigidBody(u),this.meshes.push(t)}oh(t,i,s,h=1,e="box",n=null){let o=null;if(null==n){let i=t[1]._boundingInfo.boundingBox.maximum,s=t[1]._boundingInfo.boundingBox.minimum,h=Math.abs(i.y)+Math.abs(s.y);n={x:Math.abs(i.x)+Math.abs(s.x),y:h,z:Math.abs(i.z)+Math.abs(s.z)}}if("box"===e)o=new Ammo.btBoxShape(new Ammo.btVector3(n.x/2,n.y,n.z/2));const a=new Ammo.btVector3(0,0,0);o.calculateLocalInertia(h,a),o.setMargin(0);const l=new Ammo.btTransform;l.setIdentity();t[0].position;l.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const r=new Ammo.btDefaultMotionState(l),m=new Ammo.btRigidBodyConstructionInfo(h,r,o,a),B=new Ammo.btRigidBody(m);B.objectMesh=t[0];for(let s in t)t[s].metadata={physicsBody:null,tag:i},t[s].metadata.physicsBody=B;window.ammoPlugin.world.addRigidBody(B),this.meshes.push(t[0])}ah(t,i,s,h=0){for(let i in t){if("__root__"==t[i].name)continue;let s=t[i].getVerticesData(BABYLON.VertexBuffer.PositionKind),e=new Ammo.btTriangleMesh,n=new Ammo.btVector3(0,0,0),o=new Ammo.btVector3(0,0,0),a=new Ammo.btVector3(0,0,0),l=[];for(let t=0;t<s.length;t+=3)l.push({x:s[t],y:s[t+1],z:s[t+2]});for(let t=0;t<l.length-3;t+=3)n.setX(l[t].x),n.setY(l[t].y),n.setZ(l[t].z),o.setX(l[t+1].x),o.setY(l[t+1].y),o.setZ(l[t+1].z),a.setX(l[t+2].x),a.setY(l[t+2].y),a.setZ(l[t+2].z),e.addTriangle(n,o,a,!0);Ammo.destroy(n),Ammo.destroy(o),Ammo.destroy(a);let r=new Ammo.btConvexTriangleMeshShape(e,!0);const m=new Ammo.btVector3(0,0,0);r.calculateLocalInertia(h,m),r.setMargin(0);const B=new Ammo.btTransform;B.setIdentity();const w=t[i].position;B.setOrigin(new Ammo.btVector3(w.x,w.y,w.z));const u=new Ammo.btDefaultMotionState(B),A=new Ammo.btRigidBodyConstructionInfo(h,u,r,m),c=new Ammo.btRigidBody(A);t[i].metadata={physicsBody:null},t[i].metadata.physicsBody=c;let d=t[0].clone();d.metadata={physicsBody:null},d.metadata.physicsBody=c,window.ammoPlugin.world.addRigidBody(c);let p={meshes:[]};p.meshes.push(d),p.meshes.push(t[i]),this.meshes.push(p.meshes[0])}}async lh(t,i){let s=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),h=(t.getVerticesData(BABYLON.VertexBuffer.NormalKind),t.getVerticesData(BABYLON.VertexBuffer.ColorKind),t.getVerticesData(BABYLON.VertexBuffer.UVKind),t.getIndices());t.updateFacetData();var e=t.getFacetLocalPositions().length;let n=new Ammo.btTriangleMesh;new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0);for(var o=0;o<e;){var a=o++,l=h[3*a],r=h[3*a+1],m=h[3*a+2],B=new Ammo.btVector3(s[3*l],s[3*l+1],s[3*l+2]),w=new Ammo.btVector3(s[3*r],s[3*r+1],s[3*r+2]),u=new Ammo.btVector3(s[3*m],s[3*m+1],s[3*m+2]);n.addTriangle(B,w,u)}let A=new Ammo.btBvhTriangleMeshShape(n,!0,!0);this[i]=A}async Zi(t,i){let s=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),h=new Ammo.btTriangleMesh,e=new Ammo.btVector3(0,0,0),n=new Ammo.btVector3(0,0,0),o=new Ammo.btVector3(0,0,0),a=[];for(let t=0;t<s.length;t+=3)a.push({x:s[t],y:s[t+1],z:s[t+2]});for(let t=0;t<a.length-3;t+=3)e.setX(a[t].x),e.setY(a[t].y),e.setZ(a[t].z),n.setX(a[t+1].x),n.setY(a[t+1].y),n.setZ(a[t+1].z),o.setX(a[t+2].x),o.setY(a[t+2].y),o.setZ(a[t+2].z),h.addTriangle(e,n,o,!0);Ammo.destroy(e),Ammo.destroy(n),Ammo.destroy(o);var l=new Ammo.btConvexTriangleMeshShape(h,!0);this[i]=l}Ki(t,i,s,h,e=0,n={velocity:1,direction:{x:1,y:1,z:1},damping:[0,0],friction:0,margin:0}){const o=new Ammo.btVector3(0,0,0);h.calculateLocalInertia(e,o),h.setMargin(n.margin);const a=new Ammo.btTransform;a.setIdentity(),a.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const l=new Ammo.btDefaultMotionState(a),r=new Ammo.btRigidBodyConstructionInfo(e,l,h,o),m=new Ammo.btRigidBody(r);let B=new BABYLON.Vector3(n.direction.x,n.direction.y,n.direction.z).scaleInPlace(n.velocity);m.setFriction(n.friction),m.setLinearVelocity(new Ammo.btVector3(B.x,B.y,B.z)),0!=e?(m.setCollisionFlags(32),m.setActivationState(4),m.activate(!0)):m.setCollisionFlags(1),m.objectMesh=t;let w=null,u=function(){};if("grenadethrow"==i&&(w=this.gs.clone(),w.attachToMesh(t),u=this.eh),null!=t.meshes)for(let h=0;h<t.meshes.length;h++)t.meshes[h].metadata={physicsBody:m,tag:i,_callback:u.bind(t[0]),collisionCount:0,_sound:w,initialPosition:{x:s.x,y:s.y,z:s.z},_soundExplosion:this.Ys.clone()};else t.metadata={physicsBody:m,tag:i,_callback:u.bind(t),collisionCount:0,_sound:w,initialPosition:{x:s.x,y:s.y,z:s.z},_soundExplosion:this.Ys.clone()};"grenadethrow"==i&&this.R.push(t),window.ammoPlugin.world.addRigidBody(m),null!=t.meshes?(this.meshes.push(t.meshes[0]),t.meshes[0].metadata._callback()):(t.metadata._callback(),this.meshes.push(t))}rh(t,i,s,h=0,e={velocity:1.1,direction:{x:0,y:-1,z:0}}){let n=t[1].getVerticesData(BABYLON.VertexBuffer.PositionKind),o=new Ammo.btTriangleMesh,a=new Ammo.btVector3(0,0,0),l=new Ammo.btVector3(0,0,0),r=new Ammo.btVector3(0,0,0),m=[];for(let t=0;t<n.length;t+=3)m.push({x:n[t],y:n[t+1],z:n[t+2]});for(let t=0;t<m.length-3;t+=3)a.setX(m[t].x),a.setY(m[t].y),a.setZ(m[t].z),l.setX(m[t+1].x),l.setY(m[t+1].y),l.setZ(m[t+1].z),r.setX(m[t+2].x),r.setY(m[t+2].y),r.setZ(m[t+2].z),o.addTriangle(a,l,r,!0);Ammo.destroy(a),Ammo.destroy(l),Ammo.destroy(r);let B=new Ammo.btConvexTriangleMeshShape(o,!0);const w=new Ammo.btVector3(0,0,0);B.calculateLocalInertia(h,w),B.setMargin(0);const u=new Ammo.btTransform;u.setIdentity();t[0].position;u.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const A=new Ammo.btDefaultMotionState(u),c=new Ammo.btRigidBodyConstructionInfo(h,A,B,w),d=new Ammo.btRigidBody(c);let p=new BABYLON.Vector3(e.direction.x,e.direction.y,e.direction.z).scaleInPlace(e.velocity);d.setLinearVelocity(new Ammo.btVector3(p.x,p.y,p.z)),d.setFriction(5),d.objectMesh=t[0];for(let s in t)t[s].metadata={tag:i,physicsBody:null,_root:t[0]},t[s].rotationQuaternion=null,t[s].metadata.physicsBody=d;window.ammoPlugin.world.addRigidBody(d),this.meshes.push(t[0])}Js(t){let i=t.movementX/500;this.v-=i;var s=.002*t.movementY*.8;if(this.xi.rotation=new BABYLON.Vector3(s+this.xi.rotation.x,0,this.xi.rotation.z),null!=B){const t=function(t,i){var s=new Ammo.btQuaternion,h=.5*i,e=Math.sin(h);return s.setValue(Math.cos(h),t[0]*e,t[1]*e,t[2]*e),s}([0,1,0],o-=i);B.getWorldTransform().setRotation(t)}let h=this.xi.getForwardRay();new BABYLON.Vector3(h.direction.x,0,h.direction.z)}}}],i={};function s(h){var e=i[h];if(void 0!==e)return e.exports;var n=i[h]={exports:{}};return t[h](n,n.exports,s),n.exports}s.d=(t,i)=>{for(var h in i)s.mh(i,h)&&!s.mh(t,h)&&Object.defineProperty(t,h,{Bh:!0,get:i[h]})},s.mh=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"wh",{value:!0})};var h={};(()=>{s.r(h);var t=s(1);new class{A;uh;o;Ah;dh;ph;Lh;Oh;ammoPlugin;xi;fh;gh;u;os;constructor(){this.Nh()}async Nh(){await this.Yh(),await this.yh()}async bh(){var t=BABYLON.Mesh.CreateBox("skyBox",1e3,scene),i=new BABYLON.StandardMaterial("skyBox",scene);i.backFaceCulling=!1,i.reflectionTexture=new BABYLON.CubeTexture("textures/TropicalSunnyDay",scene),i.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,i.diffuseColor=new BABYLON.Color3(0,0,0),i.specularColor=new BABYLON.Color3(0,0,0),i.disableLighting=!0,t.material=i}async _h(){var t=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),i=new BABYLON.GUI.StackPanel;i.width="220px",i.fontSize="14px",i.kh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,t.addControl(i);[{transform:"position",xh:"x",value:0},{transform:"position",xh:"y",value:.06},{transform:"position",xh:"z",value:0}].forEach((t=>{var s=new BABYLON.GUI.TextBlock;s.text=t.transform+" "+t.xh,s.height="40px",s.color="white",s.Mh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,s.paddingTop="10px",i.addControl(s);var h=new BABYLON.GUI.Slider;h.kh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,h.minimum=-3,h.maximum=3,h.color="green",h.value=t.value,h.height="20px",h.width="300px",i.addControl(h),h.onValueChangedObservable.add((i=>{if(null!=this.os.St)for(let h in this.os.St)this.os.St[h].position[t.xh]=i,s.text=t.transform+" "+t.xh+":"+i}))}));var s=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),h=new BABYLON.GUI.StackPanel;h.width="220px",h.fontSize="14px",h.kh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,h.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,s.addControl(i);[{transform:"rotation",xh:"x",value:1.51},{transform:"rotation",xh:"y",value:-3.14},{transform:"rotation",xh:"z",value:.72},{transform:"rotation",xh:"w",value:0}].forEach((t=>{var s=new BABYLON.GUI.TextBlock;s.text=t.transform+" "+t.xh,s.height="40px",s.color="white",s.Mh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,s.paddingTop="10px",i.addControl(s);var h=new BABYLON.GUI.Slider;h.kh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,h.minimum=-Math.PI,h.maximum=Math.PI,h.color="green",h.value=t.value,h.height="20px",h.width="205px",i.addControl(h),h.onValueChangedObservable.add((i=>{if(null!=this.os.St)for(let h in this.os.St)this.os.St[h].rotation[t.xh]=i,s.text=t.transform+" "+t.xh+":"+i}))}))}async yh(){this.uh=await new BABYLON.Engine(this.A),this.uh.displayLoadingUI(),this.o=new BABYLON.Scene(this.uh);let t=document.getElementsByClassName("close");for(let i=0;i<t.length;i++)t[i].onclick=function(){this.parentNode.style.display="none"};new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),this.o).intensity=.7,await this.Ph(),this.uh.runRenderLoop((()=>{this.o.render()}))}async Ph(){await Ammo().then((i=>{this.ammoPlugin=new BABYLON.AmmoJSPlugin,window.ammoPlugin=this.ammoPlugin,this.o.enablePhysics(new BABYLON.Vector3(0,-9.81,0),this.ammoPlugin),this.os=new t.default(this.o,this.A,this.uh),this.o.registerBeforeRender((()=>{}))}))}async Ch(){var t=BABYLON.MeshBuilder.CreateGround("ground",{width:160,height:160},this.o);t.material=new BABYLON.GridMaterial("groundMaterial",this.o),t.physicsImpostor=new BABYLON.PhysicsImpostor(t,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.9},this.o);const i=BABYLON.MeshBuilder.CreateBox("platform1",{width:5,depth:5,height:1});i.position.copyFrom(new BABYLON.Vector3(-20,0,20)),i.physicsImpostor=new BABYLON.PhysicsImpostor(i,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.1}),this.L=BABYLON.MeshBuilder.CreateBox("outer",{width:.4,depth:.4,height:2},this.o),this.L.position.copyFrom(new BABYLON.Vector3(0,2,0)),this.L.isVisible=!1,this.L.isPickable=!1,this.L.checkCollisions=!0,this.L.physicsImpostor=new BABYLON.PhysicsImpostor(this.L,BABYLON.PhysicsImpostor.BoxImpostor,{mass:80,restitution:0}),BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","george8.glb",this.o).then((t=>{const i=t.meshes[0];i.parent=this.L,i.position=new BABYLON.Vector3(0,-1,0),i.isPickable=!1,i.getChildMeshes().forEach((t=>{t.isPickable=!1}))})),this.xi.parent=this.L;let s=this.L.position.x,h=this.L.position.y,e=this.L.position.z,n=new BABYLON.Vector3(this.L.position.x,this.L.position.y-1,this.L.position.z-3);this.xi.position.copyFrom(n),this.xi.setTarget(new BABYLON.Vector3(s,h-2,e)),this.cs(),this.ds()}async Rh(){let t=new Ammo.btCapsuleShape(1,5),i=new Ammo.btTransform;i.setIdentity();const s=this.L.position;i.setOrigin(new Ammo.btVector3(s.x,s.y,s.z)),i.setRotation(new Ammo.btQuaternion(0,0,0,1));const h=new Ammo.btDefaultMotionState(i),e=new Ammo.btVector3(0,0,0);t.calculateLocalInertia(80,e);const n=new Ammo.btRigidBodyConstructionInfo(80,h,t,e);this.fh=new Ammo.btRigidBody(n),this.fh.setFriction(4),this.fh.setRollingFriction(10),this.Oh.addRigidBody(this.fh)}async Yh(){document.documentElement.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.documentElement.style.width="100%",document.documentElement.style.height="100%",document.documentElement.style.margin="0",document.documentElement.style.padding="0",document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0",document.body.style.padding="0",this.A=document.createElement("canvas"),this.A.style.width="100%",this.A.style.height="100%",this.A.id="gameCanvas",document.body.appendChild(this.A)}}})()})();