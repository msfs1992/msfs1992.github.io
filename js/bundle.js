(()=>{"use strict";var t=[,(t,i,s)=>{s.r(i),s.d(i,{default:()=>d});var h,n,o=.01;let a=document.getElementById("fps");var l=0;document.getElementById("Vertices");let r;document.getElementById("Faces"),document.getElementById("Objects");var m,B,A,w,u,c;const d=class{t=100;debug=!1;i;h;brickshape;o;l;m=[];B=[];A;u;p=!1;O;L=!1;N=Date.now();g=!1;Y;v=0;_=new BABYLON.Quaternion(0,0,0,1);k=!1;M=!1;S=Date.now();C=!1;R=[];P=!1;T;D=null;I=!1;F;G;j;H=[];U;W=!1;Z=Date.now();V=!1;K=new BABYLON.Vector3(0,0,0);J=new BABYLON.Quaternion(0,0,0,1);q=!1;X=Date.now();$;tt={shift:!1,f:!1,w:!1,it:!1};st=[];animations=[];ht=[];et=[];nt="";ot="";lt=[];rt=!1;Bt;At;wt=!1;ut=!1;ct=!1;dt=null;Ot=!1;Lt=.05;Nt=.1;ft=.05;gt;Yt;yt=!1;vt;bt;_t=!1;kt=!1;xt=0;Mt=1;St=!1;Ct=Date.now();Rt=null;Pt=null;Tt=null;Dt=null;zt=null;meshes=[];It=!1;Ft={x:-.04,y:.06,z:.06};Gt={x:1.51,y:-3.14,z:.72};Et={x:.019,y:-.04,z:-.22};jt={x:1.946,y:2.896,z:-.536};Ht={x:.019,y:-.04,z:-.22};Ut={x:1.793,y:3.11,z:-.536};Wt=!1;Zt={x:0,y:.23,z:-.18};Vt={x:-1.547,y:0,z:0};Kt={x:.0199,y:0,z:-.2599};Jt={x:1.4865,y:.4444,z:-2.9883};grenadeShape;Qt;qt;Xt=1.1;$t=1;ti=60;ii=12;si=!1;hi=null;ei=new BABYLON.Vector3;ni=!1;oi=!1;ai=!1;li;ri;mi=new BABYLON.Vector3;Bi=!1;Ai=!1;wi;ui=Date.now();ci;di=[];pi;Oi=new Ammo.btTransform;Li=!1;Ni=Date.now();fi="idle0";gi=[];Yi;yi=!1;vi={meshes:[]};constructor(t,i,s){if((c=t).setRenderingAutoClearDepthStencil(1,!1,!0,!1),c.setRenderingAutoClearDepthStencil(2,!1,!0,!1),r=s,this.u=i,(m=new BABYLON.TerrainMaterial("terrainMaterial",c)).specularColor=new BABYLON.Color3(.5,.5,.5),m.specularPower=64,m.mixTexture=new BABYLON.Texture("textures/mixMap.png",c),m.diffuseTexture1=new BABYLON.Texture("textures/floor.png",c),m.diffuseTexture2=new BABYLON.Texture("textures/rock.png",c),m.diffuseTexture3=new BABYLON.Texture("textures/grass.png",c),m.bumpTexture1=new BABYLON.Texture("textures/floor_bump.png",c),m.bumpTexture2=new BABYLON.Texture("textures/rockn.png",c),m.bumpTexture3=new BABYLON.Texture("textures/grassn.png",c),m.diffuseTexture1.uScale=m.diffuseTexture1.vScale=10,m.diffuseTexture2.uScale=m.diffuseTexture2.vScale=10,m.diffuseTexture3.uScale=m.diffuseTexture3.vScale=10,fetch("particles/systems/linearFire.json").then((t=>t.text())).then(this.bi.bind(this)),fetch("particles/systems/explosion.json").then((t=>t.text())).then(this._i.bind(this)),this.A=BABYLON.Mesh.CreateBox("skyBox",2e3,c),!this.debug){var h=new BABYLON.StandardMaterial("skyBox",c);h.backFaceCulling=!1,h.reflectionTexture=new BABYLON.CubeTexture("textures/TropicalSunnyDay",c),h.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,h.diffuseColor=new BABYLON.Color3(0,0,0),h.specularColor=new BABYLON.Color3(0,0,0),h.disableLighting=!0,this.A.material=h}this.vt=new BABYLON.HighlightLayer("hl1",c,{ki:!1}),this.vt.xi=!1,this.O=BABYLON.MeshBuilder.CreateBox("outer",{width:.6,depth:.6,height:2,updatable:!0},c),this.debug?(this.Mi=new BABYLON.ArcRotateCamera("camera1",Math.PI/2,Math.PI/4,5,new BABYLON.Vector3(0,1,0),c),this.Mi.attachControl(this.u,!0),this.Mi.lowerRadiusLimit=2,this.Mi.upperRadiusLimit=10,this.Mi.wheelDeltaPercentage=.01):this.Mi=new BABYLON.UniversalCamera("camera1",new BABYLON.Vector3(0,2,-3),c),this.Mi.attachControl(this.u,!0);let e=new BABYLON.Texture("./textures/decal-diffuse.png",c);this.pi=new BABYLON.StandardMaterial("decalMat",c),this.pi.diffuseTexture=e,this.pi.diffuseColor=new BABYLON.Color3(0,0,0),this.pi.diffuseTexture.hasAlpha=!0,this.pi.zOffset=-2,this.Si(),this.Ci()}Ri(){}_i(t){u=JSON.parse(t)}bi(t){this.l=JSON.parse(t)}Pi(t){if(null!=this.meshes)for(let t=0,i=this.meshes.length;t<i;t++){const i=this.meshes[t],s=i.metadata.physicsBody,h=s.getMotionState();if(h){h.getWorldTransform(this.Oi);const t=this.Oi.getOrigin(),e=this.Oi.getRotation();if("barrel"==i.metadata.tag)if(this.Wt)this.Wt=!1,s.setLinearVelocity(new Ammo.btVector3(0,0,0)),s.setLinearVelocity(new Ammo.btVector3(0,10,0));else{i.position.copyFrom(new BABYLON.Vector3(t.x(),t.y(),t.z()));let s=new BABYLON.Quaternion(e.x(),e.y(),e.z(),1);i.rotation.copyFrom(s)}else{i.position.copyFrom(new BABYLON.Vector3(t.x(),t.y(),t.z()));let s=new BABYLON.Quaternion(e.x(),e.y(),e.z(),1);i.rotation.copyFrom(s)}}}}Ti(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","Grenade-soviet-low2.glb",c).then((t=>{this.U=t;for(let t in this.U.meshes)this.U.meshes[t].position.y-=1,this.U.meshes[t].rotationQuaternion=null;this.U.meshes[0].id="__tgrenade1__",this.U.meshes[1].id="__tgrenadeshape1__",this.U.meshes[0].name="__tgrenade1__",this.U.meshes[1].name="__tgrenadeshape1__"}))}Di(){var t=this.B.length;if(3!=t)if(this.V){var i=this.zi.meshes[1].createInstance("ai"+t,t);i.rotation.z+=Math.PI/1.5,i.attachToBone(this.m[t],this.zt[0]),this.st.push({type:"instance",meshes:i}),this.B.push(0)}else BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","Grenade-soviet-low1.glb",c).then((t=>{this.zi=t,this.st.push({type:"array",meshes:[this.zi.meshes[0],this.zi.meshes[1]]});let i=new BABYLON.Vector3(this.Ft.x,this.Ft.y,this.Ft.z),s=new BABYLON.Quaternion(this.Gt.x,this.Gt.y,this.Gt.z,1);this.V=!0;for(let t in this.zi.meshes)this.zi.meshes[t].attachToBone(this.Pt,this.zt[0]),this.zi.meshes[t].position.copyFrom(i),this.zi.meshes[t].rotationQuaternion=null,this.zi.meshes[t].rotation.copyFrom(s);this.zi.meshes[0].id="__tgrenade__",this.zi.meshes[1].id="__tgrenadeshape__",this.zi.meshes[0].name="__tgrenade__",this.zi.meshes[1].name="__tgrenadeshape__"}))}Ii(t,i,s,h){for(var e=new Float32Array(t*i),n=h-s,o=t/2,a=i/2,l=0,r=0;r<i;r++)for(var m=0;m<t;m++){var B=Math.sqrt(Math.pow((m-o)/o,2)+Math.pow((r-a)/a,2)),A=.5*(Math.sin(12*B)+1)*n+s;e[l]=A,l++}return e}async Fi(t){const i=new Ammo.btHeightfieldTerrainShape(150,150,undefined,1,-2,2,1,"PHY_FLOAT",!1);i.setMargin(0);let s=new Ammo.btTransform;s.setIdentity();let h=new Ammo.btVector3(0,0,0),e=new Ammo.btDefaultMotionState(s),n=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(0,e,i,h));t.metadata={physicsBody:null,tag:"ground",_callback:null,collisionCount:0,_sound:null,_soundExplosion:null},n.objectMesh=t,t.metadata.physicsBody=n,t.metadata.physicsBody.objectMesh=t,window.ammoPlugin.world.addRigidBody(n),this.meshes.push(t)}Gi(){(n=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("gui")).background="rgba(0,0,0,0.8)";var t=BABYLON.GUI.Button.CreateSimpleButton("btn","START");t.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,t.widthInPixels=200,t.heightInPixels=40,t.color="white",t.background="green",n.addControl(t),t.onPointerClickObservable.add((()=>{document.body.requestPointerLock()}))}Ci(){this.Gi();for(var t=-1;t<2;t++)for(var i=-1;i<2;i++)this.Ei(t,i)}Ei(t,i){let s=BABYLON.MeshBuilder.CreateGroundFromHeightMap("ground","./textures/patterns5.png",{width:150,height:150,subdivisions:100,updatable:!0,maxHeight:2,minHeight:-2,onReady:()=>{s.position.copyFrom(new BABYLON.Vector3(150*i,0,150*t)),s.material=m,this.ji(s,new BABYLON.Vector3(150*i,0,150*t),0),1==t&&1==i&&this.Hi()}},c)}Ui(t,i,s,h){let e=t[1].getVerticesData(BABYLON.VertexBuffer.PositionKind),n=(t[1].getVerticesData(BABYLON.VertexBuffer.NormalKind),t[1].getVerticesData(BABYLON.VertexBuffer.ColorKind),t[1].getVerticesData(BABYLON.VertexBuffer.UVKind),t[1].getIndices());t[1].updateFacetData();var o=t[1].getFacetLocalPositions().length;let a=new Ammo.btTriangleMesh;new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0);for(var l=0;l<o;){var r=l++,m=n[3*r],B=n[3*r+1],A=n[3*r+2],w=new Ammo.btVector3(e[3*m],e[3*m+1],e[3*m+2]),u=new Ammo.btVector3(e[3*B],e[3*B+1],e[3*B+2]),c=new Ammo.btVector3(e[3*A],e[3*A+1],e[3*A+2]);a.addTriangle(w,u,c)}let d=new Ammo.btBvhTriangleMeshShape(a,!0,!0),p=new Ammo.btVector3(0,0,0);d.calculateLocalInertia(h,p),d.setMargin(0);let O=new Ammo.btTransform;O.setIdentity(),O.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));let L=new Ammo.btDefaultMotionState(O),N=new Ammo.btRigidBodyConstructionInfo(h,L,d,p),f=new Ammo.btRigidBody(N);for(let i in t)t[i].metadata={physicsBody:null},t[i].rotationQuaternion=null,t[i].metadata.physicsBody=f;window.ammoPlugin.world.addRigidBody(f),this.meshes.push(t[0])}ji(t,i,s,h=new Ammo.btVector3(0,0,0)){let e=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),n=(t.getVerticesData(BABYLON.VertexBuffer.NormalKind),t.getVerticesData(BABYLON.VertexBuffer.ColorKind),t.getVerticesData(BABYLON.VertexBuffer.UVKind),t.getIndices());t.updateFacetData();var o=t.getFacetLocalPositions().length;let a=new Ammo.btTriangleMesh;new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0);for(var l=0;l<o;){var r=l++,m=n[3*r],B=n[3*r+1],A=n[3*r+2],w=new Ammo.btVector3(e[3*m],e[3*m+1],e[3*m+2]),u=new Ammo.btVector3(e[3*B],e[3*B+1],e[3*B+2]),c=new Ammo.btVector3(e[3*A],e[3*A+1],e[3*A+2]);a.addTriangle(w,u,c)}let d=new Ammo.btBvhTriangleMeshShape(a,!0,!0);d.setMargin(0);let p=new Ammo.btVector3(0,0,0),O=new Ammo.btTransform;O.setIdentity(),O.setOrigin(new Ammo.btVector3(i.x,i.y,i.z));let L=t.rotationQuaternion||new BABYLON.Quaternion.RotationYawPitchRoll(t.rotation.x,t.rotation.y,t.rotation.z);O.setRotation(new Ammo.btQuaternion(L.x,L.y,L.z,L.w));let N=new Ammo.btDefaultMotionState(O),f=new Ammo.btRigidBodyConstructionInfo(s,N,d,p),g=new Ammo.btRigidBody(f);t.metadata={physicsBody:null,tag:"ground",_callback:null,collisionCount:0,_sound:null,_soundExplosion:null},g.objectMesh=t,t.metadata.physicsBody=g,t.metadata.physicsBody.objectMesh=t,window.ammoPlugin.world.addRigidBody(g),this.meshes.push(t)}Wi(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","table-wooden-low7.glb",c).then((t=>{this.Zi=t;let i=this.Zi.meshes[1]._boundingInfo.boundingBox.maximum,s=this.Zi.meshes[1]._boundingInfo.boundingBox.minimum;Math.abs(i.y),Math.abs(s.y),Math.abs(i.x),Math.abs(s.x),Math.abs(i.z),Math.abs(s.z);this.Vi(this.Zi.meshes[1],"mesaShape");new Ammo.btBoxShape(new Ammo.btVector3(1,1.4,1));this.Ki(this.Zi.meshes[0],"mesa",{x:5,y:-.15,z:5},this.mesaShape,0,{velocity:0,direction:{x:0,y:0,z:0},damping:[1,1],friction:200,margin:.1}),BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","Grenade-soviet-low.glb",c).then((t=>{this.Ji=t,this.Qi.attachToMesh(this.Ji.meshes[0]),this.Ji.meshes[0].id="_rootgrenade_",this.Ji.meshes[0].name="_rootgrenade_",this.Ji.meshes[1].id="_shapegrenade_",this.Ji.meshes[1].name="_shapegrenade_",this.Vi(this.Ji.meshes[1],"grenadeShape");for(let t in this.Ji.meshes)this.Ji.meshes[t].rotationQuaternion=null;setTimeout((function(t){}),3e3,this);let i=this.Zi.meshes[0].position;this.Ji.meshes[0].position.copyFrom(new BABYLON.Vector3(i.x,i.y+1.2,i.z)),this.Zi.meshes[0].addChild(this.Ji.meshes[0]),this.Zi.meshes[0].addChild(this.Ji.meshes[1]),setTimeout((function(t){}),2e4,this)}))}))}Hi(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","cube-wall.glb",c).then((t=>{this.qi=t;let i=this.qi.meshes[1]._boundingInfo.boundingBox.maximum,s=this.qi.meshes[1]._boundingInfo.boundingBox.minimum,h=Math.abs(i.y)+Math.abs(s.y),e=Math.abs(i.x)+Math.abs(s.x)+2,n=Math.abs(i.z)+Math.abs(s.z),o=new Ammo.btBoxShape(new Ammo.btVector3(e/2,h,n/2));this.Ki(this.qi.meshes[0],"wall",{x:15,y:0,z:-30},o,0,{velocity:1,direction:{x:1,y:1,z:1},damping:[.1,.1],friction:.6,margin:.2})})),this.Wi();BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","barrel-mixed-low2.glb",c).then((t=>{this.Xi=t;let i=BABYLON.MeshBuilder.CreateSphere("explosionzone",{diameter:.1});i.isVisible=!1,this.Xi.meshes[1].addChild(i),i.position.copyFrom(new BABYLON.Vector3(0,this.Xi.meshes[1]._boundingInfo.boundingSphere.radius+1,0)),this.Vi(this.Xi.meshes[1],"barrelShape"),this.Ki(this.Xi,"barrel",{x:0,y:5,z:15},this.barrelShape,50,{velocity:0,direction:{x:0,y:0,z:0},damping:[0,0],friction:.1,margin:.1})})),this.$i()}ts(t,i){this.Mi.animations=[this.ss({property:"position",from:this.Mi.position,to:t,_callback:i})]}hs(t){const i=t%(2*Math.PI);return i<0?i+BABYLON.Tools.ToRadians(360):i}es(t){}ss({property:t,from:i,to:s,_callback:h}){const e=new BABYLON.CubicEase,n=(new BABYLON.Node("node",c),BABYLON.Animation.CreateAndStartAnimation("at4",this.Mi,"position",300,30,i,s,0,e,(function(t){h()})));return n.ns=!0,n}$i(){(new Ammo.btTransform).setIdentity();this.O.position.x,this.O.position.y,this.O.position.z;this.O.metadata={tag:"",objectMesh:null},this.O.metadata.tag="player",this.O.position.copyFrom(new BABYLON.Vector3(0,2,0));new BABYLON.Vector3(this.O.position.x,this.O.position.y-1,this.O.position.z-3);this.O.isVisible=!1,this.O.isPickable=!1,this.O.checkCollisions=!0,this.os=BABYLON.MeshBuilder.CreateBox("cubeCam",{width:.2,depth:.2,height:.2,updatable:!0},c),this.os.isVisible=!1,BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","v6.glb",c).then((t=>{this.ls=t,this.zt=t.meshes,this.rs.attachToMesh(this.ls.meshes[0]),this.Bs.attachToMesh(this.ls.meshes[0]),this.dt=t.transformNodes[63];t.animationGroups;c.As=()=>this.O.absolutePosition;let i=t.skeletons[0];this.Pt=i.bones[53],this.ws=i.bones[56],this.m.push(i.bones[69]),this.m.push(i.bones[70]),this.m.push(i.bones[71]),this.m.push(i.bones[72]);let s=new BABYLON.Vector3(0,0,0);s.add(this.O.forward),s.scaleInPlace(this.$t+this.ii),this.mi.copyFrom(s),this.us(),this.lt=["idle0","crosshair","crosshairwalk","jump","walk","run","prethrow","throw","prethrowpose","pickitem","pickitembackpack"],this.animations.idle0=this.ls.animationGroups[4],this.animations.crosshair=this.ls.animationGroups[3],this.animations.crosshairwalk=this.ls.animationGroups[11],this.animations.jump=this.ls.animationGroups[6],this.animations.walk=this.ls.animationGroups[10],this.animations.jump.speedRatio=.8,this.animations.run=this.ls.animationGroups[9],this.animations.prethrow=this.ls.animationGroups[1],this.animations.prethrowpose=this.ls.animationGroups[2],this.animations.pickitem=this.ls.animationGroups[7],this.animations.pickitem.speedRatio=.5,this.animations.pickitembackpack=this.ls.animationGroups[8],this.animations.throw=this.ls.animationGroups[0],this.animations.cs=this.ls.animationGroups[12];for(let t in this.lt){let i=this.lt[t];this.animations[i].setWeightForAllAnimatables(0),this.animations[i].play(!0),this.animations[i].normalize()}this.animations.idle0.setWeightForAllAnimatables(1),this.Bt=this.animations.idle0,this.At=this.animations.idle0,this.nt="idle0",this.ot="idle0",this.Li=!0;t.meshes[0];const e=new Ammo.btCapsuleShape(.3,1.5);B=new Ammo.btPairCachingGhostObject;const n=new Ammo.btTransform;n.setIdentity(),n.setOrigin(new Ammo.btVector3(0,5,0)),n.setRotation(new Ammo.btQuaternion(0,0,Math.PI/2,0)),B.objectMesh={metadata:{tag:"player"}},B.setWorldTransform(n),B.setCollisionShape(e),B.setCollisionFlags(32),B.setActivationState(4),B.activate(!0),B.setAnisotropicFriction(0),B.setCcdMotionThreshold(0),B.setContactProcessingThreshold(0),B.setFriction(1),B.setRollingFriction(1),(w=new Ammo.btKinematicCharacterController(B,e,.1,1)).setGravity(9.81),w.canJump(),w.setMaxJumpHeight(1.3),w.setJumpSpeed(4),w.setUpInterpolate(!1),w.setUseGhostSweepTest(!1);const o=c.getPhysicsEngine().getPhysicsPlugin().world;o.addCollisionObject(B,32,3),o.addAction(w),(h=this.ls.meshes[0]).parent=this.O,h.position=new BABYLON.Vector3(0,-1,0),h.isPickable=!1,h.getChildMeshes().forEach((t=>{t.isPickable=!1}));setTimeout((function(t){console.log("SETTING CAMERA OFFSET");var i=w.getGhostObject().getWorldTransform().getOrigin();new BABYLON.Vector3(i.x(),i.y()-1,i.z()-3);t.Mi.setTarget(t.O.absolutePosition),r.hideLoadingUI(),t.It=!0}),2e4,this),A=B.getWorldTransform()})),this.Mi.parent=this.O,this.Mi.position.y=this.O.absolutePosition.y+.5,this.ds(),this.ps()}Os(t,i){t.bakeCurrentTransformIntoVertices();let s=t.getVerticesData(BABYLON.VertexBuffer.PositionKind);var h=new Ammo.btHeightfieldTerrainShape(150,150,s,1,-2,2,1,"PHY_FLOAT",!1);let e=new Ammo.btTransform;e.setIdentity(),e.setOrigin(new Ammo.btVector3(0,0,0));let n=new Ammo.btVector3(0,0,0),o=new Ammo.btDefaultMotionState(e),a=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(0,o,h,n));window.ammoPlugin.world.addRigidBody(a)}us(){BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","chaleco2.glb",c).then((t=>{this.Ls=t,this.ht.idle0=this.Ls.animationGroups[4],this.ht.crosshair=this.Ls.animationGroups[3],this.ht.crosshairwalk=this.Ls.animationGroups[11],this.ht.jump=this.Ls.animationGroups[5],this.ht.jump.speedRatio=.8,this.ht.walk=this.Ls.animationGroups[10],this.ht.run=this.Ls.animationGroups[9],this.ht.prethrow=this.Ls.animationGroups[1],this.ht.prethrowpose=this.Ls.animationGroups[2],this.ht.pickitem=this.Ls.animationGroups[6],this.ht.pickitem.speedRatio=.5,this.ht.pickitembackpack=this.Ls.animationGroups[7],this.ht.throw=this.Ls.animationGroups[0],this.ht.cs=this.Ls.animationGroups[12];for(let t in this.lt){let i=this.lt[t];this.animations[i].reset(),this.ht[i].reset(),this.ht[i].setWeightForAllAnimatables(0),this.ht[i].play(!0),this.ht[i].normalize()}this.ht.idle0.setWeightForAllAnimatables(1),this.Ls.meshes[0].parent=this.O,this.Ls.meshes[0].position=new BABYLON.Vector3(0,-1,0),this.W=!0})),BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","sks3.glb",c).then((t=>{let i=t;this.qt=t.transformNodes[0],this.Dt=t.meshes,this.li.attachToMesh(i.meshes[0]),this.Ns.attachToMesh(i.meshes[0]);let s=this.zt[0],h=new BABYLON.Vector3(this.Et.x,this.Et.y,this.Et.z),e=new BABYLON.Quaternion(this.jt.x,this.jt.y,this.jt.z,1);this.rt=!0;for(let t in this.Dt)this.Dt[t].attachToBone(this.Pt,s),this.Dt[t].position.copyFrom(h),this.Dt[t].rotation.copyFrom(e);this.fs()}))}Si(){this.Qi=new BABYLON.Sound("soundGrenadePick","sounds/grenade-pick.ogg",c,null,{loop:!1,autoplay:!1,volume:.1}),this.gs=new BABYLON.Sound("soundGrenadeCollision","sounds/grenade-collision.ogg",c,null,{loop:!1,autoplay:!1,volume:.1}),this.li=new BABYLON.Sound("soundZoom","sounds/zoom-add.ogg",c,null,{loop:!1,autoplay:!0,volume:1}),this.rs=new BABYLON.Sound("soundWalk","sounds/walking.ogg",c,null,{loop:!0,autoplay:!1,volume:.5}),this.Bs=new BABYLON.Sound("soundRun","sounds/running.ogg",c,null,{loop:!0,autoplay:!1,volume:.5}),this.Ns=new BABYLON.Sound("soundPickGun","sounds/pick-gun.wav",c,null,{loop:!1,autoplay:!1,volume:.5}),this.ri=new BABYLON.Sound("soundFireBurn","sounds/fire-burn.wav",c,null,{loop:!0,autoplay:!1,volume:.1}),this.Ys=new BABYLON.Sound("soundGunShot","sounds/gunshot-short.ogg",c,null,{loop:!1,autoplay:!1,volume:.8}),this.ys=new BABYLON.Sound("soundExplosion","sounds/boom.wav",c,null,{loop:!1,autoplay:!1,volume:1}),BABYLON.Engine.audioEngine.setGlobalVolume(1)}vs(){!this.yi&&this.ai&&(this.Ys.isPlaying?(this.Ys.stop(),this.Ys.play()):this.Ys.play(),this.bs())}async _s(){if(this.i=c.getEngine().getDeltaTime()/1e3,this.It){var t=w.getGhostObject().getWorldTransform(),i=(t.getOrigin(),t.getRotation()),s=new BABYLON.Vector3(t.getOrigin().x(),t.getOrigin().y(),t.getOrigin().z());if(this.O.position=s,this.O.rotationQuaternion||(this.O.rotationQuaternion=BABYLON.Quaternion.FromEulerAngles(this.O.rotation.x,this.O.rotation.y,this.O.rotation.z)),this.O.rotationQuaternion.set(i.w(),i.x(),i.y(),i.z()),this.tt.w){this.Ai=!0;const t=A.getBasis().getRow(2);this.wi=new Ammo.btVector3(t.x(),0,t.z()).op_mul(this.Lt/1.5)}this.O.intersectsMesh(c.getMeshByName("ground"))&&(this.ct||(this.wt&&(this.wt=!1,this.ut=!1),this.ct=!0)),this.tt.w||(this.wi=new Ammo.btVector3(0,0,0)),w.setWalkDirection(this.wi)}if(this.St){if(this.oi)return;if(!this.ai){if(this.yi)return;return this.M=!0,void this.ks(this.i)}}else this.M=!1,this.ai&&!this.oi&&this.xs()}xs(){this.ni||this.oi||(this.ai&&(this.oi=!0),this.si||(this.ts(this.ei,this.onCompleteLoadingCrosshairHide.bind(this)),this.hi=null,this.ai=!1,document.getElementById("crosshair").style.display="none"))}async ks(t){var i=new BABYLON.Vector3;if(i.copyFrom(this.Mi.position),i.x-=.5,i.z+=.1,!this.ni)if(this.ei.copyFrom(this.Mi.position),this.oi)console.log("CANNOT LOAD CROSSHAIR BEACUSE IS ALREADY LOADING");else if(this.oi=!0,this.ai||(this.oi=!0),null==this.hi){if(this.hi=this.Mi.rotation,this.si)return;console.log("MOVING CAMERA SNIPER TO TARGET POSITION"),this.ts(new BABYLON.Vector3(this.Mi.position.x+.5,this.Mi.position.y,this.Mi.position.z+.5),this.Ms.bind(this))}}async Ss(){let t=Date.now();if(t-this.Ni>12e3){let i=Math.floor(1*Math.random());return this.Ni=t,this.fi="idle"+i,"idle"+i}return this.fi}Cs(){let t=this.zi.meshes[1].createInstance("o",l);l++;var i=c.pick(window.innerWidth/2,window.innerHeight/2);i.ray.origin,new BABYLON.Vector3(this.O.absolutePosition.x,this.O.absolutePosition.y+1.4,this.O.absolutePosition.z);let s=i.ray.direction;this.Ki(t,"grenadethrow",{x:this.O.position.x,y:this.O.position.y+1.5,z:this.O.position.z},this.grenadeShape,.5,{velocity:22,direction:{x:s.x,y:s.y,z:s.z},damping:[.1,.1],friction:1,margin:.3});new BABYLON.Vector3(s.x,s.y,s.z).scaleInPlace(23);let h=this.st[this.B.length];if("instance"==h.type)c.removeMesh(h.meshes);else for(let t in h.meshes)c.removeMesh(h.meshes[t]);1==this.st.length?(this.st=[],this.V=!1):(this.st.pop(),this.B.pop())}Rs(){let t=new BABYLON.Vector3(this.Et.x,this.Et.y,this.Et.z),i=new BABYLON.Quaternion(this.jt.x,this.jt.y,this.jt.z,1);for(let s in this.Dt)this.Dt[s].position.copyFrom(t),this.Dt[s].rotation.copyFrom(i)}Ps(){let t=new BABYLON.Vector3(this.Ht.x,this.Ht.y,this.Ht.z),i=new BABYLON.Quaternion(this.Ut.x,this.Ut.y,this.Ut.z,1);for(let s in this.Dt)this.Dt[s].position.copyFrom(t),this.Dt[s].rotation.copyFrom(i)}Ts(){let t=new BABYLON.Vector3(this.Zt.x,this.Zt.y,this.Zt.z),i=new BABYLON.Quaternion(this.Vt.x,this.Vt.y,this.Vt.z,1);for(let s in this.Dt)this.Dt[s].attachToBone(this.ws,this.zt[0]),this.Dt[s].position.copyFrom(t),this.Dt[s].rotation.copyFrom(i)}Ds(){let t=new BABYLON.Vector3(this.Et.x,this.Et.y,this.Et.z),i=new BABYLON.Quaternion(this.jt.x,this.jt.y,this.jt.z,1);for(let s in this.Dt)this.Dt[s].attachToBone(this.Pt,this.zt[0]),this.Dt[s].position.copyFrom(t),this.Dt[s].rotation.copyFrom(i)}async zs(){if(this.It){if(this.tt.shift||this.ut||this.wt||!this.tt.w)if(this.tt.shift&&this.tt.w&&!this.ut&&!this.wt)this.St?(this.At=this.animations.crosshairwalk,this.nt="crosshairwalk",this.Lt=this.ft,this.Bs.isPlaying?(this.Bs.stop(),this.rs.isPlaying||this.rs.play(!0)):this.rs.isPlaying||this.rs.play(!0)):(this.At=this.animations.run,this.Lt=this.Nt,this.nt="run");else if(!this.wt||this.ut||this.tt.shift)if(!this.ut&&this.Is){let t=await this.Ss();this.At=this.animations[t],this.Lt=this.ft,this.nt=t,this.rs.isPlaying&&this.rs.stop(),this.Bs.isPlaying&&this.Bs.stop()}else if(this.ut)this.At=this.animations.jump,this.nt="jump",this.Lt=this.ft,this.rs.isPlaying&&this.rs.stop(),this.Bs.isPlaying&&this.Bs.stop();else if(this.rs.isPlaying&&this.rs.stop(),this.Bs.isPlaying&&this.Bs.stop(),this.M||this.ni)this.At=this.animations.crosshair,this.nt="crosshair";else if(this.V&&this.g)if(this.k){if(Date.now()-this.X>1600){if(this.At.isPlaying){this.Ot=!0,document.getElementById("crosshair").style.display="block";for(let t in this.animations)this.animations[t].setWeightForAllAnimatables(0),this.ht[t].setWeightForAllAnimatables(0);this.At=this.animations.prethrowpose,this.nt="prethrowpose",this.At.setWeightForAllAnimatables(1),this.ht[this.nt].setWeightForAllAnimatables(1),this.kt=!1,this.Bt=this.At,this.ot=this.nt,this.xt=0,this.Mt=1}}else this.At=this.animations.prethrow,this.nt="prethrow"}else this.X=Date.now(),this.k=!0,this.nt="prethrow",this.animations.prethrow.restart(),this.animations.prethrow.stop(),this.animations.prethrow.start(!0),this.ht.prethrow.restart(),this.ht.prethrow.stop(),this.ht.prethrow.start(!0),this.At=this.animations.prethrow,this.Lt=this.ft;else if(this.Ot)if(this.P){if(Date.now()-this.Z>1600){if(this.At.isPlaying){this.Ot=!1,this.k=!1,this.P=!1,document.getElementById("crosshair").style.display="none";for(let t in this.animations)this.animations[t].setWeightForAllAnimatables(0),this.ht[t].setWeightForAllAnimatables(0);this.At=this.animations.idle0,this.nt="idle0",this.At.setWeightForAllAnimatables(1),this.ht[this.nt].setWeightForAllAnimatables(1),this.kt=!1,this.Bt=this.At,this.ot=this.nt,this.xt=0,this.Mt=1}}else this.nt="throw",this.At=this.animations.throw,this.Lt=this.ft}else this.Z=Date.now(),this.P=!0,this.Cs(),this.animations.throw.restart(),this.animations.throw.stop(),this.animations.throw.start(!0),this.ht.throw.restart(),this.ht.throw.stop(),this.ht.throw.start(!0),this.nt="throw",this.At=this.animations.throw,this.Lt=this.ft;else if(this.tt.f&&this.p)if(this.Bi){if(Date.now()-this.ui>900){if(this.At.isPlaying){this.Qi.play(),this.Bi=!1;for(let t in this.animations)this.animations[t].setWeightForAllAnimatables(0),this.ht[t].setWeightForAllAnimatables(0);this.At=this.animations.idle0,this.nt="idle0",this.At.setWeightForAllAnimatables(1),this.ht[this.nt].setWeightForAllAnimatables(1),this.kt=!1,this.Bt=this.At,this.ot=this.nt,this.xt=0,this.Mt=1,this.tt.f=!1}}else this.At=this.animations.pickitem,this.nt="pickitem"}else this.Di(),this.ui=Date.now(),this.Bi=!0,this.animations.pickitem.stop(),this.animations.pickitem.restart(),this.animations.pickitem.start(!0),this.ht.pickitem.stop(),this.ht.pickitem.restart(),this.ht.pickitem.start(!0),this.nt="pickitem",this.At=this.animations.pickitem,this.Lt=this.ft;else if(this.tt.f&&!this.p)if(this.C){if(Date.now()-this.S>500&&this.At.isPlaying){this.kt=!1,this.C=!1,this.yi?(this.Ds(),this.yi=!1):(this.Ts(),this.yi=!0);for(let t in this.animations)this.ht[t].setWeightForAllAnimatables(0),this.animations[t].setWeightForAllAnimatables(0);this.At=this.animations.idle0,this.nt="idle0",this.At.setWeightForAllAnimatables(1),this.ht[this.nt].setWeightForAllAnimatables(1),this.xt=0,this.Mt=1,this.At.syncAllAnimationsWith(null),this.ht[this.nt].syncAllAnimationsWith(null),this.Bt.syncAllAnimationsWith(this.At.animatables[0]),this.ht[this.ot].syncAllAnimationsWith(this.ht[this.nt].animatables[0]),this.At.setWeightForAllAnimatables(1),this.ht[this.nt].setWeightForAllAnimatables(1),this.Bt.setWeightForAllAnimatables(0),this.ht[this.ot].setWeightForAllAnimatables(0),this.At.normalize(),this.ht[this.nt].normalize(),this.Bt=this.At,this.ot=this.nt,this.tt.f=!1}}else this.S=Date.now(),this.C=!0,this.Ns.play(!0),this.animations.pickitembackpack.stop(),this.animations.pickitembackpack.restart(),this.animations.pickitembackpack.start(!0),this.ht.pickitembackpack.stop(),this.ht.pickitembackpack.restart(),this.ht.pickitembackpack.start(!0),this.nt="pickitembackpack",this.At=this.animations.pickitembackpack,this.Lt=this.ft;else{this.Bt,this.rs.isPlaying&&this.rs.stop(),this.Bs.isPlaying&&this.Bs.stop();let t=await this.Ss();this.nt=t,this.At=this.animations[t],this.Lt=this.ft}else this.At=this.animations.jump,this.nt="jump",this.rs.isPlaying&&this.rs.stop(),this.Bs.isPlaying&&this.Bs.stop();else this.St?(this.At=this.animations.crosshairwalk,this.nt="crosshairwalk",this.Lt=this.ft):(this.At=this.animations.walk,this.Lt=this.ft,this.nt="walk");null!=this.At&&this.Bt!==this.At&&(this.kt=!0)}}Fs(t,i){let s=1,h=0;i.Gs;for(let e=0;e<=1;e+=.08)h+=.002,s-=.002,i.setWeightForAllAnimatables(h),t.setWeightForAllAnimatables(s)}Es(){for(let i=0;i<this.di.length;i++){let s=this.di[i];if(s.intersectsMesh(c.getMeshByName("platform1"))||s.intersectsMesh(c.getMeshByName("Cylinder"))||s.intersectsMesh(c.getMeshByName("ground"))){let h=s.metadata,e=h.sourceMesh,n=h.position,o=h.normal,a=0,l=!0;var t=new BABYLON.Vector3(.25,.25,.25);BABYLON.MeshBuilder.CreateDecal("decal",e,{position:n,normal:o,angle:a,size:t,cullBackFaces:l,localMode:!0}).material=this.pi,this.js(e),c.removeMesh(s),this.ri.attachToMesh(e),this.ri.play(!0),this.di=this.di.filter(((t,s)=>t!=i))}}}fs(){this.Hs=new Ammo.ConcreteContactResultCallback,this.Hs.addSingleResult=function(t,i,s,h,e,n,o){if(Ammo.wrapPointer(t,Ammo.btManifoldPoint).getDistance()>0)return;let a=Ammo.wrapPointer(i,Ammo.btCollisionObjectWrapper),l=Ammo.castObject(a.getCollisionObject(),Ammo.btRigidBody),r=Ammo.wrapPointer(e,Ammo.btCollisionObjectWrapper),m=Ammo.castObject(r.getCollisionObject(),Ammo.btRigidBody),B=l.objectMesh,A=m.objectMesh;if(null!=B&&null!=A){let t=A.metadata.tag,i=B.metadata.tag;if(("player"==i||"player"==t)&&(this.ct||(this.wt&&(this.wt=!1,this.ut=!1),this.ct=!0),this.N=Date.now()),"grenadethrow"==i){if("ground"==t||"wall"==t){let t=B.metadata._sound;if(B.metadata.collisionCount<6){let i=Date.now();(i>B.metadata.Us+200||!B.metadata.Us)&&(B.metadata.Us=i,B.metadata.collisionCount+=1,B.metadata._sound.isPlaying?(t.stop(),t.play()):t.play())}}}else if("grenadethrow"==t&&("ground"==i||"wall"==i)){let t=A.metadata._sound;if(A.metadata.collisionCount<6){let i=Date.now();(i>A.metadata.Us+200||!A.metadata.Us)&&(A.metadata.Us=i,A.metadata.collisionCount+=1,A.metadata._sound.isPlaying?(t.stop(),t.play()):t.play())}}}}.bind(this)}Ws(t){const i=new t.ConcreteContactResultCallback;return i.Zs=!1,i.addSingleResult=function(s,h,e,n,o,a,l){return t.wrapPointer(s,ammoInstance.btManifoldPoint).getDistance()>0?0:(i.Zs=!0,1)},i}Vs(){if(this.It){if(this.R.length>0)for(let t in this.R)window.ammoPlugin.world.contactTest(this.R[t].metadata.physicsBody,this.Hs);if(w.onGround()&&(this.ct||(this.wt&&(this.wt=!1,this.ut=!1),this.ct=!0)),null!=this.Zi&&null!=this.O){let t=this.Zi.meshes[0].position,i=this.O.position,s=new BABYLON.Vector3(t.x,t.y,t.z),h=new BABYLON.Vector3(i.x,i.y,i.z);if(BABYLON.Vector3.Distance(s,h)<2){if(this.L)return;null!=this.Ji&&(this.p=!0,this.vt.blurHorizontalSize=0,this.vt.blurVerticalSize=0,this.vt.addMesh(this.Ji.meshes[1],BABYLON.Color3.Green()),this.L=!0)}else null!=this.Ji&&(this.p=!1,this.vt.removeMesh(this.Ji.meshes[1]),this.L=!1)}}}ps(){c.registerBeforeRender((()=>{a.innerHTML="<b>FPS: "+r.getFps().toFixed()+"</b>",this._s(),this.Ks(),this.zs(),this.Vs(),this.Pi()}))}Ks(){if(this.kt)if(this.xt+=.5,this.Mt-=.5,"Rig|Rig|jump0"==this.Bt.name&&w.onGround())this.Bt.setWeightForAllAnimatables(0),this.At.setWeightForAllAnimatables(1),this.W&&(this.ht[this.ot].setWeightForAllAnimatables(0),this.ht[this.nt].setWeightForAllAnimatables(1)),this.kt=!1,this.Bt=this.At,this.ot=this.nt,this.xt=0,this.Mt=1;else{if(this.nt==this.ot&&"Rig|Rig|Prethrow"!=this.At.name&&"Rig|Rig|Throw"!=this.At.name&&"Rig|Rig|PickItem"!=this.At.name&&"Rig|Rig|PickBackpack"!=this.At.name){this.W&&this.ht[this.nt].setWeightForAllAnimatables(1),this.animations[this.nt].setWeightForAllAnimatables(1);for(let t=0;t<this.lt.length;t++)this.nt!=this.lt[t]&&(this.animations[this.lt[t]].setWeightForAllAnimatables(0),this.W&&this.ht[this.lt[t]].setWeightForAllAnimatables(0)),t==this.lt.length-1&&(this.Bt=this.At,this.ot=this.nt,this.xt=0,this.Mt=1);return}if(this.At.syncAllAnimationsWith(null),this.Bt.syncAllAnimationsWith(this.At.animatables[0]),this.At.setWeightForAllAnimatables(this.xt),this.Bt.setWeightForAllAnimatables(this.Mt),this.At.normalize(),this.W){let t=this.ht[this.nt],i=this.ht[this.ot];t.syncAllAnimationsWith(null),i.syncAllAnimationsWith(t.animatables[0]),t.setWeightForAllAnimatables(this.xt),i.setWeightForAllAnimatables(this.Mt)}if(this.xt>=1){this.kt=!1,this.xt=1,this.Mt=0,this.W&&(this.ht[this.nt].setWeightForAllAnimatables(this.xt),this.ht[this.ot].setWeightForAllAnimatables(this.Mt)),this.At.setWeightForAllAnimatables(this.xt),this.Bt.setWeightForAllAnimatables(this.Mt);for(let t=0;t<this.lt.length;t++)this.nt!=this.lt[t]&&(this.animations[this.lt[t]].setWeightForAllAnimatables(0),this.W&&this.ht[this.lt[t]].setWeightForAllAnimatables(0)),t==this.lt.length-1&&(this.Bt=this.At,this.ot=this.nt,this.xt=0,this.Mt=1)}}else null!=this.At&&this.At.normalize()}async ds(){this.debug||document.addEventListener("pointerlockchange",this.Js.bind(this),!1),document.addEventListener("pointermove",this.Qs.bind(this)),document.addEventListener("keydown",this.qs.bind(this)),document.addEventListener("keyup",this.Xs.bind(this)),document.addEventListener("mousedown",this.$s.bind(this)),document.addEventListener("mouseup",this.th.bind(this)),document.addEventListener("wheel",this.ih.bind(this))}async Ms(){let t=new BABYLON.Vector3(this.Kt.x,this.Kt.y,this.Kt.z),i=new BABYLON.Quaternion(this.Jt.x,this.Jt.y,this.Jt.z,1);for(let s in this.Dt)this.Dt[s].position.copyFrom(t),this.Dt[s].rotation.copyFrom(i);if(this.oi=!1,this.ai=!0,this.ni){new BABYLON.Vector3(0,0,0).add(this.O.forward);var s=c.pick(window.innerWidth/2,window.innerHeight/2);let t=this.$t+this.ii/10,i=new BABYLON.Vector3(this.Mi.position.x,this.Mi.position.y,this.Mi.position.z+t);s.ray.origin._x,s.ray.direction._x,s.ray.origin._z,s.ray.direction._z;this.mi.copyFrom(i),this.Mi.position.copyFrom(i),document.getElementById("sniper-crosshair-box").style.display="block"}}onCompleteLoadingCrosshairHide(){this.oi=!1,this.ai=!1;let t=new BABYLON.Vector3(this.Et.x,this.Et.y,this.Et.z),i=new BABYLON.Quaternion(this.jt.x,this.jt.y,this.jt.z,1);for(let s in this.Dt)this.Dt[s].position.copyFrom(t),this.Dt[s].rotation.copyFrom(i)}ih(t){if(this.ni){var i=c.pick(window.innerWidth/2,window.innerHeight/2);if(t.deltaY>0){if(1==this.$t)return;this.li.isPlaying||this.li.play(),this.Xt<1.1?this.Xt+=.1:this.Xt=1.1,this.$t--;let t=(this.$t+this.ii)/10,s=(this.Mi.position.x,i.ray.direction.x,this.Mi.position.z,i.ray.direction.z,new BABYLON.Vector3(this.Mi.position.x,this.Mi.position.y,this.Mi.position.z-t));if(s.z<this.qt.absolutePosition.z){new BABYLON.Vector3(s.x,this.qt.absolutePosition.y,s.z);this.$t=1}else this.Mi.position.copyFrom(s)}else{if(this.$t==this.ti)return;this.li.isPlaying||this.li.play(),this.Xt>.1?this.Xt-=.1:this.Xt=.1,this.$t++;let t=(this.$t+this.ii)/10,s=(i.ray.origin.x,i.ray.direction.x,i.ray.origin.z,i.ray.direction.z,new BABYLON.Vector3(this.Mi.position.x,this.Mi.position.y,this.Mi.position.z+t));this.Mi.position.copyFrom(s)}}}th(t){if(2==t.button){let t=Date.now();if(this.ni)return this.ni=!1,document.getElementById("sniper-crosshair-box").style.display="none",this.Xt=1.1,void(this.St=!1);if((t-this.Ct)/60<11&&!this.ni){this.ni=!0,this.ai=!0,this.oi=!1,this.Xt=.8;var i=new BABYLON.Vector3;i.add(this.O.forward),i.scaleInPlace(2),console.log("LOADING SNIPER CROSSHAIR PHASE 1")}this.St=!1}else 0==t.button&&(this.g=!1)}$s(t){var i;if(this.It)if(("which"in(t=t||window.event)||"button"in e)&&(i=2==t.button),i)this.St=!0,this.Xt=.8,this.Ct=Date.now(),this.ts(new BABYLON.Vector3(this.Mi.position.x+.5,this.Mi.position.y,this.Mi.position.z+.5),(()=>{})),document.getElementById("crosshair").style.display="block";else if(0==t.button)if(this.g=!0,null==this.Rt)this.Rt=Date.now(),this.vs();else{var s=Date.now();s>this.Rt+0&&(this.vs(),this.Rt=s)}}sh(){}Js(t){null==document.pointerLockElement?this.Gi():n.dispose()}Xs(t){switch(this.Ai=!1,t.which){case 16:this.Bs.isPlaying&&(this.Bs.stop(),this.tt.w&&this.rs.play(!1)),this.tt.shift=!1,this.yi||this.Rs();break;case 70:default:break;case 87:this.rs.isPlaying&&this.rs.stop(),this.Bs.isPlaying&&this.Bs.stop(),this.tt.w=!1;break;case 32:this.tt.it=!1}}qs(t){switch(this.Ai=!0,t.which){case 16:this.tt.shift=!0,this.tt.w&&(this.yi||this.Ps(),this.rs.isPlaying&&this.rs.stop(),this.Bs.isPlaying||this.Bs.play(!1));break;case 70:this.tt.f=!0;break;case 87:this.rs.isPlaying||this.rs.play(!1),this.tt.w=!0;break;case 32:this.wt||(this.animations.jump.reset(),this.ht.jump.reset(),this.ct=!1,w.jump(),this.wt=!0,this.ut=!0),this.tt.it=!0}}jump(){this.ct=!1,this.animations.jump.reset(),this.ht.jump.reset();let t=this.O.forward,i=new BABYLON.Vector3(t.x/this.Lt,t.y/this.Lt,t.z/this.Lt);this.O.moveWithCollisions(i);this.O.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(this.O.forward.x+currentLinearVelocity._x,1,this.O.forward.z+currentLinearVelocity._z))}bs(){let t=this.qt.absolutePosition;var i=c.pick(window.innerWidth/2,window.innerHeight/2);i.ray.origin.z+=3;let s,h=i.ray.direction;s=new BABYLON.Vector3(t.x,t.y,t.z);const e=this.Mi.getForwardRay().direction.negateInPlace().normalize(),n=i.pickedPoint,o=i.pickedMesh;if(null==o)return;var a=new BABYLON.Vector3(.05,.05,.05);if("Cylinder"==o.name){this.Wt=!0,this.js(o);Math.random(),h.x,Math.random(),Math.random(),h.z}BABYLON.MeshBuilder.CreateDecal("decal",o,{position:n,normal:e,angle:0,size:a,cullBackFaces:!0,localMode:!0}).material=this.pi}hh(t){let i=BABYLON.ParticleSystem.Parse(t,c,"");i.disposeOnStop=!0,i.emitter=this,i.start(1)}js(t){let i=t._children[0];u.systems.forEach(this.hh.bind(i));Math.random();t.metadata.physicsBody.applyImpulse(new Ammo.btVector3(0,100,0),new Ammo.btVector3(0,-5,0)),this.eh(t,i)}eh(t,i){null!=this.D&&this.D.dispose(),this.D=BABYLON.ParticleSystem.Parse(this.l,c,"");let s=this.ys.clone();this.ri.isPlaying||(this.ri.attachToMesh(t),this.ri.play(!0)),s.attachToMesh(t),s.play(!0),setTimeout((function(t,i){t.emitter=i,t.start(1)}),1500,this.D,i)}nh(){setTimeout((function(t){t.metadata._soundExplosion.play(!0),u.systems.forEach((i=>{let s=BABYLON.ParticleSystem.Parse(i,c,"");s.disposeOnStop=!0,s.emitter=t,s.start(1);Math.random();setTimeout((function(t){t.metadata.physicsBody.applyImpulse(new Ammo.btVector3(0,2,0),new Ammo.btVector3(0,-5,0))}),600,t)}))}),5e3,this)}oh(t,i,s,h=1,e="sphere",n=1,o=1,a={x:0,y:0,z:0}){let l=null;l=new Ammo.btSphereShape(n);const r=new Ammo.btVector3(0,0,0);l.calculateLocalInertia(h,r),l.setMargin(0);const m=new Ammo.btTransform;m.setIdentity(),m.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const B=new Ammo.btDefaultMotionState(m),A=new Ammo.btRigidBodyConstructionInfo(h,B,l,r),w=new Ammo.btRigidBody(A);let u=new BABYLON.Vector3(a.x,a.y,a.z);u.scaleInPlace(o),w.setFriction(100),w.setDamping(.5,.5),w.setLinearVelocity(new Ammo.btVector3(u.x,u.y,u.z)),t.metadata={physicsBody:null,tag:i,_callback:null,collisionCount:0,_sound:null,_soundExplosion:null},t.metadata.physicsBody=w,w.objectMesh=t,window.ammoPlugin.world.addRigidBody(w),this.meshes.push(t)}ah(t,i,s,h=1,e="box",n=null){let o=null;if(null==n){let i=t[1]._boundingInfo.boundingBox.maximum,s=t[1]._boundingInfo.boundingBox.minimum,h=Math.abs(i.y)+Math.abs(s.y);n={x:Math.abs(i.x)+Math.abs(s.x),y:h,z:Math.abs(i.z)+Math.abs(s.z)}}if("box"===e)o=new Ammo.btBoxShape(new Ammo.btVector3(n.x/2,n.y,n.z/2));const a=new Ammo.btVector3(0,0,0);o.calculateLocalInertia(h,a),o.setMargin(0);const l=new Ammo.btTransform;l.setIdentity();t[0].position;l.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const r=new Ammo.btDefaultMotionState(l),m=new Ammo.btRigidBodyConstructionInfo(h,r,o,a),B=new Ammo.btRigidBody(m);B.objectMesh=t[0];for(let s in t)t[s].metadata={physicsBody:null,tag:i},t[s].metadata.physicsBody=B;window.ammoPlugin.world.addRigidBody(B),this.meshes.push(t[0])}lh(t,i,s,h=0){for(let i in t){if("__root__"==t[i].name)continue;let s=t[i].getVerticesData(BABYLON.VertexBuffer.PositionKind),e=new Ammo.btTriangleMesh,n=new Ammo.btVector3(0,0,0),o=new Ammo.btVector3(0,0,0),a=new Ammo.btVector3(0,0,0),l=[];for(let t=0;t<s.length;t+=3)l.push({x:s[t],y:s[t+1],z:s[t+2]});for(let t=0;t<l.length-3;t+=3)n.setX(l[t].x),n.setY(l[t].y),n.setZ(l[t].z),o.setX(l[t+1].x),o.setY(l[t+1].y),o.setZ(l[t+1].z),a.setX(l[t+2].x),a.setY(l[t+2].y),a.setZ(l[t+2].z),e.addTriangle(n,o,a,!0);Ammo.destroy(n),Ammo.destroy(o),Ammo.destroy(a);let r=new Ammo.btConvexTriangleMeshShape(e,!0);const m=new Ammo.btVector3(0,0,0);r.calculateLocalInertia(h,m),r.setMargin(0);const B=new Ammo.btTransform;B.setIdentity();const A=t[i].position;B.setOrigin(new Ammo.btVector3(A.x,A.y,A.z));const w=new Ammo.btDefaultMotionState(B),u=new Ammo.btRigidBodyConstructionInfo(h,w,r,m),c=new Ammo.btRigidBody(u);t[i].metadata={physicsBody:null},t[i].metadata.physicsBody=c;let d=t[0].clone();d.metadata={physicsBody:null},d.metadata.physicsBody=c,window.ammoPlugin.world.addRigidBody(c);let p={meshes:[]};p.meshes.push(d),p.meshes.push(t[i]),this.meshes.push(p.meshes[0])}}async rh(t,i){let s=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),h=(t.getVerticesData(BABYLON.VertexBuffer.NormalKind),t.getVerticesData(BABYLON.VertexBuffer.ColorKind),t.getVerticesData(BABYLON.VertexBuffer.UVKind),t.getIndices());t.updateFacetData();var e=t.getFacetLocalPositions().length;let n=new Ammo.btTriangleMesh;new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0),new Ammo.btVector3(0,0,0);for(var o=0;o<e;){var a=o++,l=h[3*a],r=h[3*a+1],m=h[3*a+2],B=new Ammo.btVector3(s[3*l],s[3*l+1],s[3*l+2]),A=new Ammo.btVector3(s[3*r],s[3*r+1],s[3*r+2]),w=new Ammo.btVector3(s[3*m],s[3*m+1],s[3*m+2]);n.addTriangle(B,A,w)}let u=new Ammo.btBvhTriangleMeshShape(n,!0,!0);this[i]=u}async Vi(t,i){let s=t.getVerticesData(BABYLON.VertexBuffer.PositionKind),h=new Ammo.btTriangleMesh,e=new Ammo.btVector3(0,0,0),n=new Ammo.btVector3(0,0,0),o=new Ammo.btVector3(0,0,0),a=[];for(let t=0;t<s.length;t+=3)a.push({x:s[t],y:s[t+1],z:s[t+2]});for(let t=0;t<a.length-3;t+=3)e.setX(a[t].x),e.setY(a[t].y),e.setZ(a[t].z),n.setX(a[t+1].x),n.setY(a[t+1].y),n.setZ(a[t+1].z),o.setX(a[t+2].x),o.setY(a[t+2].y),o.setZ(a[t+2].z),h.addTriangle(e,n,o,!0);Ammo.destroy(e),Ammo.destroy(n),Ammo.destroy(o);var l=new Ammo.btConvexTriangleMeshShape(h,!0);this[i]=l}Ki(t,i,s,h,e=0,n={velocity:1,direction:{x:1,y:1,z:1},damping:[0,0],friction:0,margin:0}){const o=new Ammo.btVector3(0,0,0);h.calculateLocalInertia(e,o),h.setMargin(n.margin);const a=new Ammo.btTransform;a.setIdentity(),a.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const l=new Ammo.btDefaultMotionState(a),r=new Ammo.btRigidBodyConstructionInfo(e,l,h,o),m=new Ammo.btRigidBody(r);let B=new BABYLON.Vector3(n.direction.x,n.direction.y,n.direction.z).scaleInPlace(n.velocity);m.setFriction(n.friction),m.setLinearVelocity(new Ammo.btVector3(B.x,B.y,B.z)),0!=e?(m.setCollisionFlags(32),m.setActivationState(4),m.activate(!0)):m.setCollisionFlags(1),m.objectMesh=t;let A=null,w=function(){};if("grenadethrow"==i&&(A=this.gs.clone(),A.attachToMesh(t),w=this.nh),null!=t.meshes)for(let h=0;h<t.meshes.length;h++)t.meshes[h].metadata={physicsBody:m,tag:i,_callback:w.bind(t[0]),collisionCount:0,_sound:A,initialPosition:{x:s.x,y:s.y,z:s.z},_soundExplosion:this.ys.clone()};else t.metadata={physicsBody:m,tag:i,_callback:w.bind(t),collisionCount:0,_sound:A,initialPosition:{x:s.x,y:s.y,z:s.z},_soundExplosion:this.ys.clone()};"grenadethrow"==i&&this.R.push(t),window.ammoPlugin.world.addRigidBody(m),null!=t.meshes?(this.meshes.push(t.meshes[0]),t.meshes[0].metadata._callback()):(t.metadata._callback(),this.meshes.push(t))}mh(t,i,s,h=0,e={velocity:1.1,direction:{x:0,y:-1,z:0}}){let n=t[1].getVerticesData(BABYLON.VertexBuffer.PositionKind),o=new Ammo.btTriangleMesh,a=new Ammo.btVector3(0,0,0),l=new Ammo.btVector3(0,0,0),r=new Ammo.btVector3(0,0,0),m=[];for(let t=0;t<n.length;t+=3)m.push({x:n[t],y:n[t+1],z:n[t+2]});for(let t=0;t<m.length-3;t+=3)a.setX(m[t].x),a.setY(m[t].y),a.setZ(m[t].z),l.setX(m[t+1].x),l.setY(m[t+1].y),l.setZ(m[t+1].z),r.setX(m[t+2].x),r.setY(m[t+2].y),r.setZ(m[t+2].z),o.addTriangle(a,l,r,!0);Ammo.destroy(a),Ammo.destroy(l),Ammo.destroy(r);let B=new Ammo.btConvexTriangleMeshShape(o,!0);const A=new Ammo.btVector3(0,0,0);B.calculateLocalInertia(h,A),B.setMargin(0);const w=new Ammo.btTransform;w.setIdentity();t[0].position;w.setOrigin(new Ammo.btVector3(s.x,s.y,s.z));const u=new Ammo.btDefaultMotionState(w),c=new Ammo.btRigidBodyConstructionInfo(h,u,B,A),d=new Ammo.btRigidBody(c);let p=new BABYLON.Vector3(e.direction.x,e.direction.y,e.direction.z).scaleInPlace(e.velocity);d.setLinearVelocity(new Ammo.btVector3(p.x,p.y,p.z)),d.setFriction(5),d.objectMesh=t[0];for(let s in t)t[s].metadata={tag:i,physicsBody:null,_root:t[0]},t[s].rotationQuaternion=null,t[s].metadata.physicsBody=d;window.ammoPlugin.world.addRigidBody(d),this.meshes.push(t[0])}Qs(t){let i=t.movementX/500;this.v-=i;var s=.002*t.movementY*.8;if(this.Mi.rotation=new BABYLON.Vector3(s+this.Mi.rotation.x,0,this.Mi.rotation.z),null!=B){const t=function(t,i){var s=new Ammo.btQuaternion,h=.5*i,e=Math.sin(h);return s.setValue(Math.cos(h),t[0]*e,t[1]*e,t[2]*e),s}([0,1,0],o-=i);B.getWorldTransform().setRotation(t)}let h=this.Mi.getForwardRay();new BABYLON.Vector3(h.direction.x,0,h.direction.z)}}}],i={};function s(h){var e=i[h];if(void 0!==e)return e.exports;var n=i[h]={exports:{}};return t[h](n,n.exports,s),n.exports}s.d=(t,i)=>{for(var h in i)s.Bh(i,h)&&!s.Bh(t,h)&&Object.defineProperty(t,h,{Ah:!0,get:i[h]})},s.Bh=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"wh",{value:!0})};var h={};(()=>{s.r(h);var t=s(1);new class{u;uh;o;dh;ph;Oh;Lh;Nh;ammoPlugin;Mi;fh;gh;A;ls;constructor(){this.Yh()}async Yh(){await this.yh(),await this.bh()}async _h(){var t=BABYLON.Mesh.CreateBox("skyBox",1e3,scene),i=new BABYLON.StandardMaterial("skyBox",scene);i.backFaceCulling=!1,i.reflectionTexture=new BABYLON.CubeTexture("textures/TropicalSunnyDay",scene),i.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,i.diffuseColor=new BABYLON.Color3(0,0,0),i.specularColor=new BABYLON.Color3(0,0,0),i.disableLighting=!0,t.material=i}async kh(){var t=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),i=new BABYLON.GUI.StackPanel;i.width="220px",i.fontSize="14px",i.xh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,i.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,t.addControl(i);[{transform:"position",Mh:"x",value:0},{transform:"position",Mh:"y",value:.06},{transform:"position",Mh:"z",value:0}].forEach((t=>{var s=new BABYLON.GUI.TextBlock;s.text=t.transform+" "+t.Mh,s.height="40px",s.color="white",s.Sh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,s.paddingTop="10px",i.addControl(s);var h=new BABYLON.GUI.Slider;h.xh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,h.minimum=-3,h.maximum=3,h.color="green",h.value=t.value,h.height="20px",h.width="300px",i.addControl(h),h.onValueChangedObservable.add((i=>{if(null!=this.ls.Dt)for(let h in this.ls.Dt)this.ls.Dt[h].position[t.Mh]=i,s.text=t.transform+" "+t.Mh+":"+i}))}));var s=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),h=new BABYLON.GUI.StackPanel;h.width="220px",h.fontSize="14px",h.xh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,h.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,s.addControl(i);[{transform:"rotation",Mh:"x",value:1.51},{transform:"rotation",Mh:"y",value:-3.14},{transform:"rotation",Mh:"z",value:.72},{transform:"rotation",Mh:"w",value:0}].forEach((t=>{var s=new BABYLON.GUI.TextBlock;s.text=t.transform+" "+t.Mh,s.height="40px",s.color="white",s.Sh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,s.paddingTop="10px",i.addControl(s);var h=new BABYLON.GUI.Slider;h.xh=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT,h.minimum=-Math.PI,h.maximum=Math.PI,h.color="green",h.value=t.value,h.height="20px",h.width="205px",i.addControl(h),h.onValueChangedObservable.add((i=>{if(null!=this.ls.Dt)for(let h in this.ls.Dt)this.ls.Dt[h].rotation[t.Mh]=i,s.text=t.transform+" "+t.Mh+":"+i}))}))}async bh(){this.uh=await new BABYLON.Engine(this.u),this.uh.displayLoadingUI(),this.o=new BABYLON.Scene(this.uh);let t=document.getElementsByClassName("close");for(let i=0;i<t.length;i++)t[i].onclick=function(){this.parentNode.style.display="none"};new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),this.o).intensity=.7,await this.Ch(),this.uh.runRenderLoop((()=>{this.o.render()}))}async Ch(){await Ammo().then((i=>{this.ammoPlugin=new BABYLON.AmmoJSPlugin,window.ammoPlugin=this.ammoPlugin,this.o.enablePhysics(new BABYLON.Vector3(0,-9.81,0),this.ammoPlugin),this.ls=new t.default(this.o,this.u,this.uh),this.o.registerBeforeRender((()=>{}))}))}async Rh(){var t=BABYLON.MeshBuilder.CreateGround("ground",{width:160,height:160},this.o);t.material=new BABYLON.GridMaterial("groundMaterial",this.o),t.physicsImpostor=new BABYLON.PhysicsImpostor(t,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.9},this.o);const i=BABYLON.MeshBuilder.CreateBox("platform1",{width:5,depth:5,height:1});i.position.copyFrom(new BABYLON.Vector3(-20,0,20)),i.physicsImpostor=new BABYLON.PhysicsImpostor(i,BABYLON.PhysicsImpostor.BoxImpostor,{mass:0,restitution:.1}),this.O=BABYLON.MeshBuilder.CreateBox("outer",{width:.4,depth:.4,height:2},this.o),this.O.position.copyFrom(new BABYLON.Vector3(0,2,0)),this.O.isVisible=!1,this.O.isPickable=!1,this.O.checkCollisions=!0,this.O.physicsImpostor=new BABYLON.PhysicsImpostor(this.O,BABYLON.PhysicsImpostor.BoxImpostor,{mass:80,restitution:0}),BABYLON.SceneLoader.ImportMeshAsync(null,"./models/","george8.glb",this.o).then((t=>{const i=t.meshes[0];i.parent=this.O,i.position=new BABYLON.Vector3(0,-1,0),i.isPickable=!1,i.getChildMeshes().forEach((t=>{t.isPickable=!1}))})),this.Mi.parent=this.O;let s=this.O.position.x,h=this.O.position.y,e=this.O.position.z,n=new BABYLON.Vector3(this.O.position.x,this.O.position.y-1,this.O.position.z-3);this.Mi.position.copyFrom(n),this.Mi.setTarget(new BABYLON.Vector3(s,h-2,e)),this.ds(),this.ps()}async Ph(){let t=new Ammo.btCapsuleShape(1,5),i=new Ammo.btTransform;i.setIdentity();const s=this.O.position;i.setOrigin(new Ammo.btVector3(s.x,s.y,s.z)),i.setRotation(new Ammo.btQuaternion(0,0,0,1));const h=new Ammo.btDefaultMotionState(i),e=new Ammo.btVector3(0,0,0);t.calculateLocalInertia(80,e);const n=new Ammo.btRigidBodyConstructionInfo(80,h,t,e);this.fh=new Ammo.btRigidBody(n),this.fh.setFriction(4),this.fh.setRollingFriction(10),this.Nh.addRigidBody(this.fh)}async yh(){document.documentElement.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.documentElement.style.width="100%",document.documentElement.style.height="100%",document.documentElement.style.margin="0",document.documentElement.style.padding="0",document.body.style.overflow="hidden",document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0",document.body.style.padding="0",this.u=document.createElement("canvas"),this.u.style.width="100%",this.u.style.height="100%",this.u.id="gameCanvas",document.body.appendChild(this.u)}}})()})();